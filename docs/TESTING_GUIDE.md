# Инструкция по тестированию Promptozaurus

## Цель тестирования
Проверить соответствие функциональности приложения референсному проекту.

---

## 1. Работа с блоками контекста

### 1.1 Создание блоков контекста
- [ ] Создать несколько тестовых блоков контекста
- [ ] Убедиться, что блоки отображаются в левой панели
- [ ] Проверить возможность выбора и активации блока

### 1.2 Работа с элементами и субблоками
- [ ] **Создание элементов блока**: Нажать кнопку "+" на уровне блока контекста
- [ ] **Создание субблоков**: Нажать кнопку "+" внутри элемента для создания субблоков
- [ ] **Раскрытие/сворачивание**: Проверить кнопки раскрытия и сворачивания субблоков
- [ ] Убедиться, что иерархия элементов отображается корректно

---

## 2. Разделение текста (Split функция)

### 2.1 Разделение текста на субблоки
**Тестовый сценарий:**
1. Создать элемент с большим текстом
2. Нажать кнопку "Ножницы" (Split)
3. Выбрать **"Разделить на субблоки"**
4. Указать количество частей (например, 5)
5. Выбрать метод деления: **"По концу предложения"**
6. Нажать **"Предпросмотр"** для проверки результата
7. Проверить, что текст разделен корректно
8. Опционально: Отметить **"Сохранить исходный текст"** или **"Удалить исходный"**
9. Нажать **"Применить"**

**Ожидаемый результат:**
- [ ] Создано 5 субблоков под исходным элементом
- [ ] Текст разделен примерно по указанным границам
- [ ] Исходный текст сохранен или удален согласно настройкам

### 2.2 Разделение текста на основные элементы
**Тестовый сценарий:**
1. Взять тот же элемент с текстом
2. Нажать кнопку "Ножницы" (Split)
3. Выбрать **"Разделить на основные элементы"**
4. Указать количество частей (например, 3)
5. Отметить **"Удалить исходный текст"**
6. Нажать **"Предпросмотр"** (1, 2, 3 части)
7. Нажать **"Применить"**

**Ожидаемый результат:**
- [ ] Исходный элемент разделен на 3 отдельных элемента того же уровня
- [ ] Первая часть осталась в исходном элементе
- [ ] Созданы 2 новых элемента со второй и третьей частями
- [ ] Исходный большой текст удален

---

## 3. Настройка AI провайдеров

### 3.1 Добавление API ключа
**Тестовый сценарий (на примере OpenRouter):**
1. Открыть **"Настройки AI"**
2. Выбрать провайдера (например, **OpenRouter**)
3. Вставить API ключ
4. Нажать **"Проверить ключ"**

**Ожидаемый результат:**
- [x] Ключ успешно проверен
- [x] Статус изменился на **"Active"** (зеленый)

### 3.2 Настройка моделей
**Тестовый сценарий:**
1. После добавления ключа, открыть **"Настройки моделей"**
2. Нажать **"Обновить список доступных моделей"** (если провайдер поддерживает API списка моделей)
3. Выбрать модель из списка (например, **"gpt-4o-mini"** или **"meta-llama"**)
4. Настроить параметры:
   - Temperature (например, 0.7)
   - Max tokens (например, 2000)
5. Нажать **"Добавить конфигурацию"**
6. Опционально: Добавить вторую модель (например, **"gpt-3.5-turbo"**)
7. Установить одну из моделей **"По умолчанию"**

**Ожидаемый результат:**
- [x] Список моделей загружен (захардкожен для всех провайдеров)
- [x] Модели добавлены в конфигурацию
- [x] Одна модель установлена по умолчанию
- [x] Конфигурации сохранены на сервере (Redis)

**Примечание для провайдеров без API списка моделей:**
- [x] Для **всех провайдеров**: модели захардкожены в коде
- [x] Список доступных моделей отображается из предустановленного списка

### 3.3 Глобальные настройки AI
Проверить третий пункт меню:
- [x] **Timeout** (тайм-аут запроса) - реализовано
- [x] **Max retries** (количество попыток повтора) - реализовано
- [x] Другие глобальные параметры (streaming, auto-save) - реализовано

---

## 4. Работа с промптами и отправка запросов

### 4.1 Создание промпта
**Тестовый сценарий:**
1. Перейти на вкладку **"Промпты"**
2. Создать новый блок промпта
3. В правой панели выбрать элементы из **"Карты контекста"**
4. Например, выбрать **"Рассказ/История текста"**
5. Проверить, что выбранный контекст отображается в промпте

**Ожидаемый результат:**
- [x] Карта контекста отображается полностью (Context Selection Panel)
- [x] Можно выбрать элементы контекста (drag-select поддерживается)
- [x] Выбранный контекст добавляется в промпт (с сохранением порядка)

### 4.2 Настройка промпта
**Проверить:**
- [ ] Текст промпта можно редактировать
- [ ] Можно включить/отключить **"Оборачивание тегами"** (например, `<text>...</text>`)
- [ ] Пример: "Кратко перескажи роман" + контекст в тегах `<text>Рассказ здесь</text>`

### 4.3 Предпросмотр и копирование
- [ ] Нажать **"Предпросмотр"** для просмотра полного промпта
- [ ] Проверить, что промпт отображается в полноэкранном режиме
- [ ] Нажать **"Копировать"** для копирования в буфер обмена
- [ ] Убедиться, что текст скопирован корректно

### 4.4 Отправка через API
**Тестовый сценарий:**
1. Выбрать модель из списка (например, **"gpt-4o-mini"** или легкую модель **"nano"**)
2. Нажать **"Сгенерировать ответ"**
3. Дождаться ответа от модели

**Ожидаемый результат:**
- [ ] Запрос отправлен успешно
- [ ] Ответ получен и отображается
- [ ] Быстрые модели (nano) отвечают быстро
- [ ] Качественные модели дают более детальные ответы

### 4.5 Сохранение ответа
**Тестовый сценарий 1 - Сохранение в новый блок:**
1. Получить ответ от AI
2. Нажать **"Сохранить в новом блоке"**
3. Система автоматически создает блок с названием

**Ожидаемый результат:**
- [ ] Создан новый блок контекста
- [ ] Ответ сохранен как элемент нового блока
- [ ] Блок отображается в левой панели

**Тестовый сценарий 2 - Сохранение в существующий блок:**
1. Получить второй ответ от AI (например, от другой модели, например **"Gemini"**)
2. Нажать **"Сохранить в существующий блок"**
3. Выбрать блок из списка (например, **"Тексты для анализа"**)
4. Нажать **"Сохранить"**

**Ожидаемый результат:**
- [ ] Ответ добавлен как новый элемент в выбранный блок
- [ ] Элемент отображается в блоке
- [ ] Можно открыть и просмотреть сохраненный ответ

**Альтернатива:**
- [ ] Опция **"Просто копировать"** - копирует ответ в буфер обмена без сохранения

---

## 5. Дополнительные функции для проверки

### 5.1 Экспорт блоков
- [ ] Экспорт блока контекста в файл
- [ ] Проверка формата экспорта

### 5.2 Удаление элементов
- [ ] Удаление элемента контекста с подтверждением
- [ ] Удаление субблока с подтверждением
- [ ] Удаление целого блока контекста

### 5.3 Перемещение элементов
- [ ] Перемещение элементов вверх/вниз
- [ ] Перемещение субблоков внутри родительского элемента

### 5.4 Полноэкранный редактор
- [ ] Открытие элемента в полноэкранном редакторе (кнопка "Редактировать")
- [ ] Редактирование текста
- [ ] Сохранение изменений

---

## 6. Проверка UI и UX

### 6.1 Панели и навигация
- [ ] Левая панель проектов сворачивается/разворачивается
- [ ] Панель контекста отображает все блоки
- [ ] Панель промптов отображает все промпты
- [ ] Редактор отображает выбранный элемент

### 6.2 Empty State (пустое состояние)
- [x] При отсутствии выбранного проекта отображается "Проект не выбран"
- [x] Кнопка "Открыть панель проектов" работает корректно
- [x] Кнопки создания блоков неактивны (серые) до выбора проекта

### 6.3 Локализация
- [ ] Все тексты отображаются на выбранном языке (RU/EN)
- [ ] Нет пропущенных ключей локализации
- [ ] Модальные окна имеют корректные заголовки

---

## Чек-лист основных функций

| Функция | Статус | Примечания |
|---------|--------|------------|
| Создание блоков контекста | ✅ | Полностью реализовано |
| Создание элементов и субблоков | ✅ | Полностью реализовано |
| Split на субблоки | ✅ | Полностью реализовано |
| Split на основные элементы | ✅ | Полностью реализовано |
| Добавление API ключей | ✅ | Реализовано для всех провайдеров |
| Проверка API ключей | ✅ | Реализовано тестирование ключей |
| Загрузка списка моделей | ⬜ | Захардкожены в коде (OpenAI, Anthropic, Gemini, Grok, OpenRouter) |
| Настройка конфигураций моделей | ✅ | Полностью реализовано с сохранением на сервере |
| Создание промптов | ✅ | Полностью реализовано |
| Выбор контекста для промпта | ✅ | **Context Selection Panel с drag-select** |
| Предпросмотр промпта | ✅ | Полностью реализовано |
| Отправка запроса через API | ✅ | Реализовано с поддержкой всех провайдеров |
| Сохранение ответа в новый блок | ⬜ | Требует реализации |
| Сохранение ответа в существующий блок | ⬜ | Требует реализации |
| Экспорт блоков | ⬜ | Требует реализации |
| Удаление элементов | ✅ | Реализовано для всех типов элементов |
| Полноэкранный редактор | ✅ | Полностью реализовано |

---

## Известные ограничения

### Google Gemini API
- **Проблема**: API ключ может не работать из-за региональных ограничений
- **Ошибка**: `"User location is not supported for the API use"`
- **Решение**: 
  1. Проверить настройки API ключа в Google Cloud Console
  2. Создать новый ключ без географических ограничений
  3. Убедиться, что IP сервера не заблокирован

### Провайдеры с хардкоженными моделями
- **Anthropic**: Список моделей захардкожен в коде (нет API для получения списка)
- **X.AI Grok**: Список моделей захардкожен

---

## Примечания для тестирования

1. **OpenRouter** - универсальный агрегатор, удобен для тестирования разных моделей
2. **Быстрые модели** (nano, flash) - используйте для быстрой проверки функциональности
3. **Качественные модели** (GPT-4, Claude) - для проверки качества ответов
4. **Split функция** - ключевая особенность проекта, тестировать тщательно
5. **Сохранение ответов** - проверить оба варианта (новый блок и существующий)

---

## Итоговый чек-лист
- [x] Все основные функции работают (кроме сохранения ответов AI и экспорта)
- [x] UI/UX соответствует ожиданиям
- [x] Нет критических ошибок
- [x] Локализация полная (EN/RU)
- [x] API интеграции работают (OpenAI, Anthropic, Gemini, Grok, OpenRouter)
- [x] Данные сохраняются корректно (PostgreSQL + Redis)

## Недавно реализованные функции (последние обновления)

### ✅ Context Selection Panel с Drag-Select
**Дата: 30 ноября 2025**
- Реализован полноценный Context Selection Panel для промпт-блоков
- Drag-to-select как в файловых менеджерах
- Визуальное отображение порядка выбора (номера на тайлах)
- Поддержка items и sub-items
- Кнопки быстрого выбора/снятия выбора
- Копирование скомпилированного контекста
- Подсчет символов в реальном времени
- Полная локализация (EN/RU)

### ✅ AI Config с серверным хранением
**Дата: 30 ноября 2025**
- Вкладка "Провайдеры" - управление API ключами
- Вкладка "Модели" - настройка конфигураций моделей
- Вкладка "Настройки" - глобальные параметры (timeout, retry, streaming)
- Хранение в Redis через backend API
- Автоматический выбор модели по умолчанию в AI Assistant
- Интеграция с AIResponseModal

### ✅ Автоматическая активация проектов
**Дата: 28-29 ноября 2025**
- Новый проект автоматически становится активным после создания
- Empty State при отсутствии выбранного проекта
- Disabled состояние для кнопок без активного проекта

