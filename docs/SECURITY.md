# Безопасность и приватность данных

## Обзор

Этот документ объясняет, как PromptyFlow обрабатывает, хранит и защищает данные пользователей. Информация предназначена для потенциальных клиентов и технических специалистов, которым важно понимать меры безопасности.

---

## Что мы храним

### 1. Данные проектов (промпты и контекст)

**Формат хранения:**
- Данные хранятся в PostgreSQL базе данных
- Используется JSONB формат для гибкой структуры
- Включает: названия проектов, блоки контекста, промпты, настройки

**Пример структуры:**
```json
{
  "project": {
    "id": "uuid",
    "name": "Мой проект",
    "data": {
      "contextBlocks": [...],
      "promptBlocks": [...]
    }
  }
}
```

**Статус шифрования:**  Не шифруются
- Данные хранятся в открытом виде в базе данных
- Доступны администраторам БД и бэкенд-серверу
- Защищены на уровне доступа к серверу

**Почему так:**
- Необходим быстрый доступ для поиска (PostgreSQL full-text search)
- Нужна возможность индексирования
- Типично для большинства SaaS приложений (Notion, Trello, Asana)

---

### 2. API ключи к AI провайдерам

**Формат хранения:**
- Хранятся в таблице `api_keys` в PostgreSQL
- Провайдеры: OpenAI, Anthropic, Google Gemini, xAI Grok, OpenRouter

**Статус шифрования:**  Полностью зашифрованы
- Алгоритм: **AES-256-GCM**
- Ключ шифрования: 32-byte ключ из переменной окружения `ENCRYPTION_KEY`
- IV (Initialization Vector): уникальный 16-byte для каждого ключа
- Auth Tag: 16-byte для проверки целостности

**Формат в БД:**
```
{iv}:{encryptedData}:{authTag}
```

**Пример:**
```
3a2b1c...:{зашифрованный ключ}:d4e5f6...
```

**Процесс:**
1. Пользователь вводит API ключ в интерфейсе
2. Backend шифрует ключ с помощью AES-256-GCM
3. Сохраняет зашифрованную версию в БД
4. При использовании расшифровывает ключ в памяти
5. Ключ никогда не возвращается в API responses

---

### 3. Учетные данные пользователей

**Что хранится:**
- Google ID (для OAuth аутентификации)
- Email адрес
- Имя пользователя
- URL аватара
- Дата регистрации и последнего входа

**Статус шифрования:**  Не шифруются
- Email и имя в открытом виде
- Google ID используется для идентификации

**Почему так:**
- Необходим для поиска пользователей по email
- Используется для отправки уведомлений
- Стандартная практика для OAuth приложений

**Пароли:** 
-  Не хранятся вообще
- Используется Google OAuth 2.0
- Пользователь авторизуется через Google
- Мы получаем только токен доступа

---

## Кто может видеть данные

### 1. Владелец данных (пользователь)

 **Полный доступ:**
- Видит все свои проекты
- Видит все свои промпты и контекст
- Может экспортировать данные
- Может удалить данные в любой момент

---

### 2. Администраторы PromptyFlow

 **Технический доступ:**

**Что мы МОЖЕМ видеть:**
- Все данные проектов (промпты, контекст)
- Email адреса пользователей
- Имена пользователей
- Статистику использования

**Что мы НЕ МОЖЕМ видеть:**
-  API ключи к AI провайдерам (они зашифрованы)
-  Пароли (их нет, используется OAuth)

**Когда мы смотрим данные:**
-  **Техническая поддержка:** при обращении пользователя с проблемой
-  **Отладка багов:** для воспроизведения и исправления ошибок
-  **Анализ производительности:** для оптимизации работы системы
-  **Юридические запросы:** по требованию правоохранительных органов

**Наша политика:**
- Мы НЕ читаем данные без необходимости
- Доступ имеют только технические специалисты
- Все действия логируются
- Соблюдаем конфиденциальность

---

### 3. AI провайдеры (OpenAI, Anthropic, и др.)

 **При отправке запросов:**

**Что они получают:**
- Текст промпта, который вы отправляете
- Контекст, который вы выбрали
- Ваш API ключ (расшифрованный)

**Что они НЕ получают:**
-  Другие ваши проекты
-  Ваш email
-  Другие промпты, которые вы не отправляли

**Важно:**
- Каждый провайдер имеет свою политику хранения данных
- OpenAI: не использует API запросы для обучения моделей (с марта 2023)
- Anthropic: аналогичная политика
- Рекомендуем ознакомиться с политикой каждого провайдера

---

### 4. Другие пользователи

 **Не имеют доступа:**
- Ваши проекты приватные
- Никто, кроме вас, не может их видеть
- Нет публичных проектов (пока)

**Будущий функционал:**
- Планируется шеринг проектов между пользователями
- Будут разные уровни доступа (view/edit)
- Вы сможете контролировать, кому даете доступ

---

## Меры безопасности

### 1. Аутентификация

 **Google OAuth 2.0**
- Надежная система авторизации от Google
- Не храним пароли пользователей
- Используем JWT токены (срок действия: 15 минут)
- Refresh tokens для обновления доступа (7 дней)

### 2. Шифрование данных в передаче

 **HTTPS/TLS**
- Все данные передаются по защищенному соединению
- Используется TLS 1.2/1.3
- Сертификат от Let's Encrypt
- Автоматическое обновление сертификатов

### 3. Шифрование API ключей

 **AES-256-GCM**
- Военный стандарт шифрования
- Уникальный IV для каждого ключа
- Auth Tag для проверки целостности
- Ключ шифрования хранится в переменных окружения, не в коде

### 4. База данных

 **PostgreSQL безопасность**
- Доступ только через закрытую сеть
- Пароли для подключения
- Регулярные бэкапы
- Логирование всех операций

### 5. Backend безопасность

 **Защита на уровне кода**
- SQL Injection: защита через Prisma ORM (параметризованные запросы)
- XSS: React автоматически экранирует JSX
- CORS: настроен белый список доменов
- Rate Limiting: 100 запросов/минуту на пользователя
- Input Validation: проверка всех входных данных с помощью Zod

### 6. Инфраструктура

 **Серверная безопасность**
- Firewall (UFW) с закрытыми портами
- Fail2ban для защиты от брутфорса
- SSH доступ только по ключам
- Автоматические обновления безопасности
- PM2 для мониторинга процессов

---

## Как это сравнивается с другими сервисами

### Notion

**Что хранится:**
-  Контент страниц шифруется при передаче (HTTPS)
-  Контент НЕ шифруется в БД (как у нас)
-  Администраторы могут видеть данные
-  Используется для индексирования и поиска

**Вывод:** Аналогично нашему подходу

---

### Trello / Asana

**Что хранится:**
-  Данные карточек/задач не шифруются в БД
-  HTTPS для передачи
-  OAuth для аутентификации

**Вывод:** Аналогично нашему подходу

---

### 1Password / Bitwarden (Password Managers)

**Что хранится:**
-  Все данные зашифрованы end-to-end
-  Master password известен только пользователю
-  Администраторы НЕ могут видеть данные
-  Нет полнотекстового поиска на сервере

**Вывод:** Более строгая модель, но:
- Сложнее в реализации
- Невозможен серверный поиск
- Требует master password
- Подходит для паролей, не для документов

---

### Google Docs / Microsoft Office 365

**Что хранится:**
-  Контент документов не зашифрован end-to-end
-  HTTPS для передачи
-  Администраторы могут видеть данные
-  Используется для поиска и сотрудничества

**Вывод:** Аналогично нашему подходу

---

## Рекомендации для клиентов

### Для максимальной безопасности:

1. **Не храните чувствительные данные в промптах**
   - Избегайте паролей, ключей доступа, персональных данных
   - Используйте абстрактные примеры

2. **Используйте разные API ключи**
   - Создайте отдельные ключи для PromptyFlow
   - Ограничьте права ключей (если провайдер позволяет)
   - Регулярно ротируйте ключи

3. **Экспортируйте данные регулярно**
   - Делайте бэкапы своих проектов
   - Храните копии локально
   - Используйте функцию экспорта в JSON

4. **Следите за доступом**
   - Используйте надежный пароль для Google аккаунта
   - Включите 2FA в Google
   - Выходите из аккаунта на общих компьютерах

5. **Удаляйте неиспользуемые данные**
   - Регулярно чистите старые проекты
   - Удаляйте неактуальные промпты
   - Это уменьшает поверхность атаки

---

## End-to-End шифрование (будущее)

### Что это такое?

**End-to-End Encryption (E2EE):**
- Данные шифруются на устройстве пользователя
- Сервер хранит зашифрованные данные
- Только пользователь имеет ключ расшифровки
- Даже администраторы не могут прочитать данные

### Почему мы не используем сейчас?

**Технические ограничения:**
-  Невозможен серверный полнотекстовый поиск
-  Сложнее делиться проектами между пользователями
-  Требует управления ключами (сложно для пользователей)
-  Если потеряли ключ = потеряли все данные

**Но мы планируем:**
- Опциональный E2EE для особо чувствительных проектов
- Пользователь сможет выбрать: удобство или максимальная безопасность
- Реализация в roadmap для версии 2.0

---

## Compliance и стандарты

### Текущий статус

**Что мы соблюдаем:**
-  HTTPS/TLS для всех подключений
-  OAuth 2.0 для аутентификации
-  AES-256-GCM для критичных данных (API ключи)
-  Best practices разработки (OWASP Top 10)
-  Регулярные бэкапы
-  Логирование доступа

**Что планируется:**
-  GDPR compliance (для работы в ЕС)
-  SOC 2 Type II (для корпоративных клиентов)
-  ISO 27001 (информационная безопасность)

---

## Права пользователей (GDPR-готовность)

### Right to Access (Право на доступ)

 Вы можете:
- Просмотреть все свои данные в любое время
- Экспортировать проекты в JSON
- Получить копию всех данных по запросу

### Right to Rectification (Право на исправление)

 Вы можете:
- Изменить любые данные в любое время
- Обновить профиль
- Исправить ошибки в проектах

### Right to Erasure (Право на удаление)

 Вы можете:
- Удалить любой проект
- Удалить свой аккаунт полностью
- Все данные будут удалены каскадно (projects, templates, API keys)

### Right to Data Portability (Право на переносимость)

 Вы можете:
- Экспортировать данные в JSON формате
- Импортировать данные обратно
- Перенести данные в другой сервис

---

## Что делать при утечке данных

### Если вы считаете, что ваши данные скомпрометированы:

1. **Немедленно:**
   - Измените API ключи у всех AI провайдеров
   - Измените пароль Google аккаунта
   - Выйдите из всех устройств

2. **Свяжитесь с нами:**
   - Email: security@promptyflow.com
   - Мы расследуем инцидент
   - Предоставим детали, если была утечка

3. **Мониторьте:**
   - Проверьте использование API ключей у провайдеров
   - Следите за неожиданными запросами
   - Проверьте логи активности (если доступны)

### Наша процедура при утечке:

1. **Уведомление:** 
   - Уведомим всех затронутых пользователей в течение 72 часов
   - Email + уведомление в приложении

2. **Расследование:**
   - Определим масштаб утечки
   - Найдем причину
   - Устраним уязвимость

3. **Отчет:**
   - Публичный post-mortem анализ
   - Меры по предотвращению
   - Обновления безопасности

---

## Контакты по безопасности

### Сообщить об уязвимости

**Email:** security@promptyflow.com

**Мы ценим ответственное раскрытие:**
- Сообщите нам приватно перед публикацией
- Дайте нам время на исправление (обычно 90 дней)
- Мы публично поблагодарим вас (если хотите)

**Bug Bounty:**
- Пока нет формальной программы
- Но мы благодарны за сообщения о багах
- Рассматриваем вознаграждение для критичных находок

---

## FAQ

**Q: Можете ли вы прочитать мои промпты?**
A: Технически да, так как данные не зашифрованы end-to-end. Но мы не читаем их без необходимости (техподдержка, отладка).

**Q: Можете ли вы увидеть мои API ключи?**
A: Нет, они зашифрованы AES-256-GCM. Мы можем только расшифровать их для отправки запросов к AI.

**Q: Что произойдет, если вы закроетесь?**
A: Мы уведомим за 30 дней. Вы сможете экспортировать все данные. Мы опубликуем инструкции для self-hosting.

**Q: Используете ли вы наши данные для обучения моделей?**
A: Нет, мы не обучаем никакие модели. Мы только предоставляем инструмент для работы с AI.

**Q: Передаете ли вы данные третьим лицам?**
A: Только AI провайдерам, когда вы отправляете запрос. Больше никому.

**Q: Где физически хранятся данные?**
A: На серверах в [указать регион]. Для корпоративных клиентов возможен выбор региона.

**Q: Как часто делаются бэкапы?**
A: Автоматические бэкапы каждые 24 часа. Хранятся 30 дней. Для критичных данных - continuous backup.

---

## Итоговая таблица безопасности

| Данные | Шифрование в БД | Шифрование при передаче | Доступ админов | Best Practice |
|--------|-----------------|------------------------|----------------|---------------|
| **Проекты (промпты/контекст)** |  Нет |  HTTPS/TLS |  Да |  Стандарт для SaaS |
| **API ключи** |  AES-256-GCM |  HTTPS/TLS |  Нет (зашифровано) |  Максимальная защита |
| **Email/имя** |  Нет |  HTTPS/TLS |  Да |  Стандарт для OAuth |
| **Пароли** | N/A (не хранятся) | N/A | N/A |  OAuth 2.0 |

---

## Заключение

**Наш подход к безопасности:**

 **Прозрачность:** Мы честно рассказываем, что и как храним

 **Баланс:** Безопасность vs Удобство vs Функциональность

 **Стандарты:** Используем industry best practices

 **Развитие:** Постоянно улучшаем меры безопасности

**Если у вас есть вопросы или опасения:**
- Email: security@promptyflow.com
- Мы открыты к диалогу
- Ваша безопасность - наш приоритет

---

**Последнее обновление:** 05.12.2025  
**Версия:** 1.0  
**Статус:** Актуально
