# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° PromptyFlow SaaS

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
2. [Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº](#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹-ÑÑ‚ĞµĞº)
3. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°](#ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
4. [Frontend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#frontend-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
5. [Backend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#backend-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
6. [Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ±Ğ°Ğ·Ğ°-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
7. [AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ](#ai-Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ)
8. [Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)
9. [ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ)
10. [ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ](#Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ)

---

## ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

PromptyFlow â€” ÑÑ‚Ğ¾ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğ¾Ğµ SaaS-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ AI-Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ğ¼Ğ¸. ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾ ĞºĞ°Ğº **Ğ¼Ğ¾Ğ½Ğ¾Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹** Ğ½Ğ° TypeScript Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑÑ‚ĞµĞºĞ° Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¹.

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PromptyFlow SaaS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Frontend      â”‚       Backend        â”‚       Shared          â”‚
â”‚   (apps/web)     â”‚      (apps/api)      â”‚  (packages/shared)    â”‚
â”‚                  â”‚                      â”‚                       â”‚
â”‚  React 18.3      â”‚  Fastify 4.28        â”‚  TypeScript Types     â”‚
â”‚  Vite 5.4        â”‚  TypeScript 5.6      â”‚  Zod Schemas          â”‚
â”‚  TanStack Query  â”‚  PostgreSQL 14+      â”‚  Validation           â”‚
â”‚  Zustand         â”‚  Prisma ORM 5.22     â”‚                       â”‚
â”‚  Tailwind CSS    â”‚  Redis 7+            â”‚                       â”‚
â”‚  i18next         â”‚  Winston Logger      â”‚                       â”‚
â”‚                  â”‚                      â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

- **Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ğ¼Ğ¸**: ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ, Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ² Ğ² Ğ±Ğ»Ğ¾ĞºĞ¸
- **ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸**: ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ¾Ğ±ÑŠĞµĞ¼Ğ¾Ğ² Ñ‚ĞµĞºÑÑ‚Ğ° Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸
- **AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ**: Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° 5 Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ² (OpenAI, Anthropic, Gemini, Grok, OpenRouter)
- **Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€**: drag-select Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° ĞºĞ°Ğº Ğ² Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ñ‹Ñ… Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°Ñ…
- **Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°**: Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ¿Ğ¾ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ğ¼ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹
- **Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹**: Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ² Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¼ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ¼
- **ĞœÑƒĞ»ÑŒÑ‚Ğ¸ÑĞ·Ñ‹Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ**: Ñ€ÑƒÑÑĞºĞ¸Ğ¹ Ğ¸ Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
- **OAuth Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ**: Ğ²Ñ…Ğ¾Ğ´ Ñ‡ĞµÑ€ĞµĞ· Google

---

## Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

### Frontend (apps/web)

| ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|-----------|------------|------------|
| **ĞÑĞ½Ğ¾Ğ²Ğ°** | React 18.3, TypeScript 5.6, Vite 5.4 | Ğ¤Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº, Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, ÑĞ±Ğ¾Ñ€Ñ‰Ğ¸Ğº |
| **Ğ¡Ñ‚Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** | Tailwind CSS 3.4 | Utility-first CSS Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº |
| **State Management** | TanStack Query v5, Zustand | Server state Ğ¸ client state |
| **HTTP** | Axios 1.7 | HTTP ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ñ interceptors |
| **Routing** | React Router 6 | ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ |
| **i18n** | react-i18next 15+ | Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (ru/en) |
| **UI Components** | @dnd-kit, react-syntax-highlighter | Drag-and-drop, Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ¾Ğ´Ğ° |
| **Notifications** | react-hot-toast | Toast ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ |

### Backend (apps/api)

| ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|-----------|------------|------------|
| **ĞÑĞ½Ğ¾Ğ²Ğ°** | Fastify 4.28, TypeScript 5.6 | Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ²ĞµĞ±-Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº |
| **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** | PostgreSQL 14+, Prisma ORM 5.22 | Ğ ĞµĞ»ÑÑ†Ğ¸Ğ¾Ğ½Ğ½Ğ°Ñ Ğ‘Ğ” Ğ¸ ORM |
| **ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** | Redis 7+ | In-memory ĞºĞµÑˆ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ AI |
| **ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ** | Google OAuth 2.0, JWT | Ğ’Ñ…Ğ¾Ğ´ Ñ‡ĞµÑ€ĞµĞ· Google |
| **Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** | Node.js crypto (AES-256-GCM) | Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡ĞµĞ¹ |
| **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** | Winston | Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸ |
| **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ** | Zod | Runtime validation |

### AI ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹

| ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ | ĞœĞ¾Ğ´ĞµĞ»Ğ¸ | ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ |
|-----------|--------|-------------|
| **OpenAI** | GPT-4o, GPT-4o-mini, GPT-4-turbo, GPT-5.1 | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ `/v1/responses` API |
| **Anthropic** | Claude 4.5, Claude 4, Claude 3.5 (Sonnet/Opus/Haiku) | Ğ’ÑĞµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ |
| **Google Gemini** | Gemini 2.5/1.5 Flash, Pro | API v1beta |
| **X.AI Grok** | Grok Beta, Grok Vision | ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ |
| **OpenRouter** | 100+ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ | ĞĞ³Ñ€ĞµĞ³Ğ°Ñ‚Ğ¾Ñ€ AI Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ |

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
Promptozaurus-saas/
â”‚
â”œâ”€â”€ apps/
â”‚   â”‚
â”‚   â”œâ”€â”€ web/                                 # Frontend Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout/                 # ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¼Ğ°ĞºĞµÑ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx          # Ğ¨Ğ°Ğ¿ĞºĞ° Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸ĞµĞ¹
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MainLayout.tsx      # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ layout
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NavigationPanel.tsx # ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ context/                # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ContextEditor.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ContextItem.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SplitModal.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ prompt/                 # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PromptEditor.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PromptItem.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ context-selection/      # Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ContextSelectionPanel.tsx
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                     # ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIConfigModal.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIResponseModal.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectList.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ConfirmationModal.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LandingPage.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthCallbackPage.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ErrorPage.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/                      # ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ Ñ…ÑƒĞºĞ¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useProjects.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAI.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAIModels.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useProjectUpdate.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useTemplates.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ context/                    # React Context
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EditorContext.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ConfirmationContext.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ store/                      # Zustand stores
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.store.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ offline.store.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/                        # Core ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ queryClient.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ i18n.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ locales/                    # ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ru/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ common.json
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ editor.json
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ aiConfig.json
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ providers.json
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ en/ (Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/                      # Ğ¥ĞµĞ»Ğ¿ĞµÑ€Ñ‹
â”‚   â”‚   â”‚   â””â”€â”€ data/                       # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ api/                                # Backend Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.ts                    # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ routes/                     # API endpoints
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.routes.ts          # OAuth, JWT refresh
â”‚       â”‚   â”‚   â”œâ”€â”€ project.routes.ts       # CRUD Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
â”‚       â”‚   â”‚   â”œâ”€â”€ context.routes.ts       # ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸
â”‚       â”‚   â”‚   â”œâ”€â”€ prompt.routes.ts        # Ğ‘Ğ»Ğ¾ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ²
â”‚       â”‚   â”‚   â”œâ”€â”€ template.routes.ts      # Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
â”‚       â”‚   â”‚   â”œâ”€â”€ ai.routes.ts            # AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
â”‚       â”‚   â”‚   â””â”€â”€ user.routes.ts          # ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ, API ĞºĞ»ÑÑ‡Ğ¸
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ services/                   # Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚       â”‚   â”‚   â”œâ”€â”€ project.service.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ template.service.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ modelsCache.service.ts
â”‚       â”‚   â”‚   â””â”€â”€ encryption.service.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ providers/                  # AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹
â”‚       â”‚   â”‚   â”œâ”€â”€ base.provider.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ openai.provider.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ anthropic.provider.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ gemini.provider.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ grok.provider.ts
â”‚       â”‚   â”‚   â””â”€â”€ openrouter.provider.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ middleware/                 # Middleware
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ errorHandler.ts
â”‚       â”‚   â”‚   â””â”€â”€ cors.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ lib/                        # Core ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
â”‚       â”‚   â”‚   â”œâ”€â”€ prisma.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ redis.ts
â”‚       â”‚   â”‚   â””â”€â”€ logger.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ utils/
â”‚       â”‚       â””â”€â”€ prompt.utils.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ prisma/
â”‚       â”‚   â”œâ”€â”€ schema.prisma
â”‚       â”‚   â””â”€â”€ migrations/
â”‚       â”‚
â”‚       â”œâ”€â”€ scripts/
â”‚       â””â”€â”€ package.json
â”‚
â””â”€â”€ packages/
    â””â”€â”€ shared/                             # ĞĞ±Ñ‰Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ñ‹
        â”œâ”€â”€ src/
        â”‚   â”œâ”€â”€ types.ts
        â”‚   â”œâ”€â”€ schemas.ts
        â”‚   â””â”€â”€ index.ts
        â””â”€â”€ package.json
```

---

## Frontend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

```
App.tsx
â”‚
â”œâ”€ ErrorBoundary                            # ĞŸĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº React
â”‚  â””â”€ QueryClientProvider                   # TanStack Query
â”‚     â””â”€ ConfirmationProvider               # ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
â”‚        â”‚
â”‚        â”œâ”€ LandingPage                     # Ğ”Ğ»Ñ Ğ³Ğ¾ÑÑ‚ĞµĞ¹
â”‚        â”‚  â”œâ”€ Header (guest)
â”‚        â”‚  â”œâ”€ Hero
â”‚        â”‚  â”œâ”€ Features
â”‚        â”‚  â””â”€ Footer
â”‚        â”‚
â”‚        â””â”€ DashboardPage                   # Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
â”‚           â””â”€ EditorProvider               # Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ğ°
â”‚              â””â”€ MainLayout
â”‚                 â”‚
â”‚                 â”œâ”€ Header (authorized)
â”‚                 â”‚  â”œâ”€ Project selector
â”‚                 â”‚  â”œâ”€ AI config
â”‚                 â”‚  â”œâ”€ Language switcher
â”‚                 â”‚  â””â”€ User menu
â”‚                 â”‚
â”‚                 â”œâ”€ NavigationPanel         # Ğ›ĞµĞ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
â”‚                 â”‚  â”œâ”€ ProjectList
â”‚                 â”‚  â””â”€ "Create project"
â”‚                 â”‚
â”‚                 â”œâ”€ BlocksPanel             # Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
â”‚                 â”‚  â”œâ”€ Tabs: Context | Prompts
â”‚                 â”‚  â”œâ”€ Blocks list
â”‚                 â”‚  â””â”€ "Create block"
â”‚                 â”‚
â”‚                 â””â”€ EditorPanel             # ĞŸÑ€Ğ°Ğ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
â”‚                    â”œâ”€ ContextEditor
â”‚                    â”‚  â”œâ”€ Title
â”‚                    â”‚  â”œâ”€ Items (drag-drop)
â”‚                    â”‚  â”œâ”€ SubItems
â”‚                    â”‚  â”œâ”€ Split modal
â”‚                    â”‚  â””â”€ Export
â”‚                    â”‚
â”‚                    â””â”€ PromptEditor
â”‚                       â”œâ”€ Template
â”‚                       â”œâ”€ Context selector
â”‚                       â”œâ”€ Preview
â”‚                       â””â”€ AI send
```

### Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼

**1. Server State (TanStack Query)**

ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼:

```typescript
// GET Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
useProjects()          // Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
useProject(id)         // ĞĞ´Ğ¸Ğ½ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
useTemplates()         // Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹
useAIModels()          // AI Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸

// ĞœÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
useUpdateProject()     // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
useDeleteProject()     // Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
useSendToAI()          // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² AI
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
- Optimistic updates
- Retry Ğ½Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…
- Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

**2. Client State (Zustand)**

Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:

```typescript
// auth.store.ts - Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
{
  user: User | null
  accessToken: string | null
  refreshToken: string | null
  login()
  logout()
  updateToken()
}

// offline.store.ts - Ğ¾Ñ„Ñ„Ğ»Ğ°Ğ¹Ğ½ Ñ€ĞµĞ¶Ğ¸Ğ¼
{
  pendingChanges: Change[]
  addPendingChange()
  syncChanges()
}
```

**3. Context API**

UI ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸:

```typescript
// EditorContext - ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ğ°
{
  activeTab: 'context' | 'prompts'
  activeContextBlockId: number | null
  activePromptBlockId: number | null
  expandedItems: Set<number>
}

// ConfirmationContext - Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ¸
{
  confirm(message)
  alert(message)
}
```

**4. Local State (useState)**

Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°:

```typescript
const [editingName, setEditingName] = useState(false)
const [localTitle, setLocalTitle] = useState(block.title)
```

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹

**Optimistic Updates**

UI Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ½ĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾, Ğ¾Ñ‚ĞºĞ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ:

```typescript
useMutation({
  onMutate: async (newData) => {
    await queryClient.cancelQueries(['projects'])
    const previous = queryClient.getQueryData(['projects'])
    queryClient.setQueryData(['projects'], optimisticData)
    return { previous }
  },
  onError: (err, data, context) => {
    queryClient.setQueryData(['projects'], context.previous)
  }
})
```

**Debounced Auto-Save**

Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ½Ğ° 500Ğ¼Ñ:

```typescript
const debouncedSave = useMemo(
  () => debounce((data) => updateProject.mutate(data), 500),
  []
)

const handleChange = (content) => {
  setLocalContent(content)  // ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾
  debouncedSave(content)    // Ğ¡ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹
}
```

**Offline Support**

Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² localStorage Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğ¸ ÑĞµÑ‚Ğ¸:

```typescript
onError: (error) => {
  if (!navigator.onLine) {
    offlineStore.addPendingChange(data)
    toast.info('ĞÑ„Ñ„Ğ»Ğ°Ğ¹Ğ½: Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾')
  }
}
```

---

## Backend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ¡Ğ»Ğ¾Ğ¸ÑÑ‚Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ROUTES LAYER                          â”‚
â”‚  â€¢ HTTP Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                                    â”‚
â”‚  â€¢ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Zod)                              â”‚
â”‚  â€¢ Middleware (auth, CORS, rate limit)                   â”‚
â”‚  â€¢ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVICE LAYER                          â”‚
â”‚  â€¢ Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°                                         â”‚
â”‚  â€¢ ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°)                      â”‚
â”‚  â€¢ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»                               â”‚
â”‚  â€¢ Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DATA ACCESS LAYER                        â”‚
â”‚  â€¢ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ‘Ğ” (Prisma)                                â”‚
â”‚  â€¢ ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Redis)                                   â”‚
â”‚  â€¢ Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ API (AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹)                          â”‚
â”‚  â€¢ Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ/Ğ´ĞµÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RESTful API

```
ğŸ“ Authentication
POST   /auth/google                 # OAuth callback
POST   /auth/refresh                # Refresh access token

ğŸ“ User Profile
GET    /api/user                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
PATCH  /api/user                    # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
POST   /api/user/api-keys/:provider # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ API ĞºĞ»ÑÑ‡
DELETE /api/user/api-keys/:provider # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ API ĞºĞ»ÑÑ‡
GET    /api/user/api-keys           # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ĞºĞ»ÑÑ‡ĞµĞ¹

ğŸ“ Projects
GET    /api/projects                # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
POST   /api/projects                # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
GET    /api/projects/:id            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
PATCH  /api/projects/:id            # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
DELETE /api/projects/:id            # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚

ğŸ“ Context Blocks
PATCH  /api/projects/:id/context-blocks        # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ
GET    /api/projects/:id/context-blocks/stats  # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°

ğŸ“ Prompt Blocks
PATCH  /api/projects/:id/prompt-blocks         # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ
POST   /api/projects/:id/prompt-blocks/compile # Ğ¡ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ

ğŸ“ Templates
GET    /api/templates               # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
GET    /api/templates/search?q=     # ĞŸĞ¾Ğ¸ÑĞº (full-text)
POST   /api/templates               # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ
PATCH  /api/templates/:id           # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ
DELETE /api/templates/:id           # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ

ğŸ“ AI Integration
GET    /ai/models                   # Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
POST   /ai/send                     # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
POST   /ai/test-connection          # Ğ¢ĞµÑÑ‚ API ĞºĞ»ÑÑ‡Ğ°
```

### Service Layer

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ProjectService:

```typescript
class ProjectService {
  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  async getUserProjects(userId: string): Promise<Project[]> {
    return prisma.project.findMany({
      where: { userId },
      orderBy: { updatedAt: 'desc' }
    })
  }

  // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸ĞµĞ¹
  async updateProject(
    projectId: string,
    userId: string,
    input: UpdateProjectInput
  ): Promise<Project> {
    // 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ğ»Ğ°Ğ´ĞµĞ»ÑŒÑ†Ğ°
    const project = await this.getProjectById(projectId, userId)
    
    // 2. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°
    if (input.data) {
      const validation = this.validateProjectSize(input.data)
      if (!validation.valid) {
        throw new Error(validation.error)
      }
    }
    
    // 3. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
    return prisma.project.update({
      where: { id: projectId },
      data: input
    })
  }

  // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ²
  validateProjectSize(data: ProjectData) {
    const MAX_PROJECT_SIZE = 10_000_000  // 10M ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
    const MAX_BLOCK_SIZE = 5_000_000     // 5M ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
    
    const { totalChars, largestBlockChars } = 
      this.calculateProjectSize(data)
    
    if (largestBlockChars > MAX_BLOCK_SIZE) {
      return { 
        valid: false, 
        error: \`Ğ‘Ğ»Ğ¾Ğº Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚\` 
      }
    }
    
    if (totalChars > MAX_PROJECT_SIZE) {
      return { 
        valid: false, 
        error: \`ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚\` 
      }
    }
    
    return { valid: true }
  }

  // ĞŸĞ¾Ğ´ÑÑ‡ĞµÑ‚ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
  calculateProjectSize(data: ProjectData) {
    let totalChars = 0
    let largestBlockChars = 0

    for (const block of data.contextBlocks || []) {
      let blockChars = 0
      
      for (const item of block.items || []) {
        // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ subItems, ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ñ…
        if (item.subItems?.length > 0) {
          blockChars += item.subItems.reduce(
            (sum, sub) => sum + (sub.chars || 0), 
            0
          )
        } else {
          blockChars += item.chars || 0
        }
      }
      
      totalChars += blockChars
      largestBlockChars = Math.max(largestBlockChars, blockChars)
    }

    return { totalChars, largestBlockChars }
  }
}
```

### Provider Pattern

Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ²:

```typescript
// Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ
abstract class BaseProvider {
  protected apiKey: string
  protected baseUrl: string

  abstract getModels(apiKey?: string): Promise<AIModel[]>
  abstract sendMessage(options: SendMessageOptions): Promise<string>
  abstract testConnection(apiKey: string): Promise<boolean>
  
  protected getFallbackModels(): AIModel[] {
    return []
  }
}

// OpenAI Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
class OpenAIProvider extends BaseProvider {
  protected getDefaultBaseUrl() {
    return 'https://api.openai.com'
  }

  async sendMessage(options: SendMessageOptions): Promise<string> {
    const { apiKey, model, messages, temperature, maxTokens } = options

    // GPT-5.1 Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ endpoint
    const isGpt5 = model.startsWith('gpt-5')
    const endpoint = isGpt5 ? '/v1/responses' : '/v1/chat/completions'

    // Ğ Ğ°Ğ·Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
    const requestBody = isGpt5 
      ? {
          model,
          input: messages.map(m => m.content).join('\n'),
          temperature,
          max_output_tokens: maxTokens
        }
      : {
          model,
          messages,
          temperature,
          max_tokens: maxTokens
        }

    const response = await fetch(\`\${this.baseUrl}\${endpoint}\`, {
      method: 'POST',
      headers: {
        'Authorization': \`Bearer \${apiKey}\`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(requestBody)
    })

    const data = await response.json()

    // Ğ Ğ°Ğ·Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
    if (isGpt5) {
      const msg = data.output?.find(i => i.type === 'message')
      const text = msg?.content?.find(c => c.type === 'output_text')?.text
      return text || ''
    }

    return data.choices[0]?.message?.content || ''
  }
}
```

### Middleware

**Authentication**

```typescript
async function authenticate(
  request: FastifyRequest,
  reply: FastifyReply
) {
  const authHeader = request.headers.authorization
  
  if (!authHeader?.startsWith('Bearer ')) {
    return reply.code(401).send({ error: 'Unauthorized' })
  }
  
  const token = authHeader.substring(7)
  const decoded = jwt.verify(token, process.env.JWT_SECRET!)
  
  request.user = {
    userId: decoded.userId,
    email: decoded.email
  }
}
```

**Error Handler**

```typescript
function errorHandler(
  error: Error,
  request: FastifyRequest,
  reply: FastifyReply
) {
  logger.error('Request error:', {
    error: error.message,
    url: request.url,
    method: request.method
  })

  if (error.message.includes('Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚')) {
    return reply.code(413).send({
      error: 'PAYLOAD_TOO_LARGE',
      message: error.message
    })
  }

  return reply.code(500).send({
    error: 'INTERNAL_SERVER_ERROR',
    message: 'Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°'
  })
}
```

---

## Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ñ…ĞµĞ¼Ğ° PostgreSQL

```prisma
model User {
  id          String    @id @default(cuid())
  googleId    String    @unique
  email       String    @unique
  name        String?
  picture     String?
  lastLoginAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  projects  Project[]
  templates Template[]
  apiKeys   ApiKey[]

  @@index([googleId])
  @@index([email])
}

model Project {
  id        String   @id @default(cuid())
  userId    String
  name      String
  data      Json     // ProjectData JSONB
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([updatedAt])
}

model Template {
  id         String   @id @default(cuid())
  userId     String
  name       String
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Full-text search
  name_tsv    Unsupported("tsvector")?
  content_tsv Unsupported("tsvector")?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([name_tsv], type: Gin)
  @@index([content_tsv], type: Gin)
}

model ApiKey {
  id           String   @id @default(cuid())
  userId       String
  provider     String   // openai | anthropic | gemini | grok | openrouter
  encryptedKey String   @db.Text
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider])
  @@index([userId])
}
```

### Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (JSONB)

```typescript
interface ProjectData {
  contextBlocks: ContextBlock[]
  promptBlocks: PromptBlock[]
}

interface ContextBlock {
  id: number
  title: string
  items: ContextItem[]
}

interface ContextItem {
  id: number
  title: string
  content: string
  chars: number
  subItems?: SubItem[]
}

interface SubItem {
  id: number
  title: string
  content: string
  chars: number
}

interface PromptBlock {
  id: number
  title: string
  template: string
  wrapInTags: boolean
  selectedContext: SelectedContext[]
}

interface SelectedContext {
  blockId: number
  itemId: number
  subItemId?: number
  order: number
}
```

### Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ¸ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**1. Full-Text Search**

```sql
-- Generated columns
ALTER TABLE templates 
ADD COLUMN name_tsv tsvector 
GENERATED ALWAYS AS (to_tsvector('english', name)) STORED;

-- GIN Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_templates_name_tsv 
ON templates USING gin(name_tsv);

CREATE INDEX idx_templates_content_tsv 
ON templates USING gin(content_tsv);
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

```typescript
const results = await prisma.$queryRaw\`
  SELECT * FROM templates
  WHERE user_id = \${userId}
    AND (name_tsv @@ to_tsquery('english', \${query})
         OR content_tsv @@ to_tsquery('english', \${query}))
  ORDER BY ts_rank(name_tsv || content_tsv, to_tsquery('english', \${query})) DESC
  LIMIT 100
\`

// Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: 1-11ms Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 7-8 ÑĞµĞºÑƒĞ½Ğ´
```

**2. ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹**

```sql
CREATE INDEX idx_projects_user_id ON projects(user_id);
CREATE INDEX idx_templates_user_id ON templates(user_id);
CREATE INDEX idx_projects_updated_at ON projects(updated_at);
```

---

## AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
CLIENT
  â”‚ POST /ai/send
  â”‚ { provider: 'openai', model: 'gpt-4o', messages: [...] }
  â–¼
ROUTE HANDLER
  â”‚ 1. Authenticate user
  â”‚ 2. Get encrypted API key from DB
  â”‚ 3. Decrypt API key
  â–¼
PROVIDER FACTORY
  â”‚ switch (provider) {
  â”‚   case 'openai': return new OpenAIProvider()
  â”‚   case 'anthropic': return new AnthropicProvider()
  â”‚   ...
  â”‚ }
  â–¼
PROVIDER INSTANCE
  â”‚ provider.sendMessage({ apiKey, model, messages, ... })
  â–¼
AI API (OpenAI/Anthropic/Gemini/Grok/OpenRouter)
  â”‚ HTTP request to external AI service
  â–¼
AI RESPONSE
  â”‚ { content: 'Generated text...', usage: {...} }
  â–¼
RETURN TO CLIENT
  â”‚ { success: true, response: 'Generated text...' }
```

### ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹

| ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ | Endpoint | ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ |
|-----------|----------|-------------|
| **OpenAI** | api.openai.com | GPT-5.1: `/v1/responses`<br>ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ: `/v1/chat/completions` |
| **Anthropic** | api.anthropic.com | `/v1/messages`<br>Claude 4.5 Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° |
| **Gemini** | generativelanguage.googleapis.com | API v1beta |
| **Grok** | api.x.ai | X.AI API |
| **OpenRouter** | openrouter.ai | ĞĞ³Ñ€ĞµĞ³Ğ°Ñ‚Ğ¾Ñ€ 100+ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ |

### ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹

```typescript
class ModelsCacheService {
  private CACHE_TTL = 3600 // 1 Ñ‡Ğ°Ñ

  async getModels(provider: string, apiKey?: string): Promise<AIModel[]> {
    const cacheKey = \`models:\${provider}\`
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Redis
    const cached = await redis.get(cacheKey)
    if (cached) return JSON.parse(cached)

    // Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ Ñƒ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
    const models = await providerInstance.getModels(apiKey)

    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² Redis
    await redis.setex(cacheKey, this.CACHE_TTL, JSON.stringify(models))

    return models
  }

  // Fallback ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ API ĞºĞ»ÑÑ‡Ğ°
  async getFallbackModels(provider: string): Promise<AIModel[]> {
    const providerInstance = this.getProviderInstance(provider)
    return providerInstance.getFallbackModels()
  }
}
```

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Google OAuth 2.0 + JWT

**ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸:**

```
1. USER CLICKS "Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Google"
   â–¼
2. REDIRECT TO GOOGLE OAUTH
   https://accounts.google.com/o/oauth2/v2/auth?
     client_id=...
     redirect_uri=https://promptyflow.com/auth/google/callback
     scope=openid email profile
   â–¼
3. USER AUTHORIZES
   Ğ’Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ»Ğ¾Ğ³Ğ¸Ğ½/Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ Google
   â–¼
4. GOOGLE REDIRECTS BACK
   https://promptyflow.com/auth/google/callback?code=<CODE>
   â–¼
5. BACKEND EXCHANGES CODE FOR TOKENS
   POST https://oauth2.googleapis.com/token
   Body: { code, client_id, client_secret, ... }
   â–¼
6. FETCH USER PROFILE
   GET https://www.googleapis.com/oauth2/v1/userinfo
   Headers: { Authorization: Bearer <access_token> }
   â–¼
7. CREATE/UPDATE USER IN DB
   prisma.user.upsert({
     where: { googleId },
     create: { googleId, email, name, picture },
     update: { lastLoginAt: new Date() }
   })
   â–¼
8. GENERATE JWT TOKENS
   Access Token (15 min): jwt.sign({ userId, email }, SECRET, { expiresIn: '15m' })
   Refresh Token (7 days): jwt.sign({ userId }, SECRET, { expiresIn: '7d' })
   â–¼
9. REDIRECT TO FRONTEND
   https://promptyflow.com/#/auth/callback?
     access_token=...&refresh_token=...
   â–¼
10. FRONTEND STORES TOKENS
   useAuthStore.login({ accessToken, refreshToken }, user)
   â–¼
11. SUBSEQUENT REQUESTS
   axios.interceptors.request.use(config => {
     config.headers.Authorization = \`Bearer \${accessToken}\`
   })
```

### Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡ĞµĞ¹

**AES-256-GCM:**

```typescript
class EncryptionService {
  private algorithm = 'aes-256-gcm'
  private key: Buffer // 32 bytes from env

  encrypt(text: string): string {
    const iv = crypto.randomBytes(16)
    const cipher = crypto.createCipheriv(this.algorithm, this.key, iv)
    
    let encrypted = cipher.update(text, 'utf8', 'hex')
    encrypted += cipher.final('hex')
    
    const authTag = cipher.getAuthTag()
    
    // Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: iv:authTag:encrypted
    return \`\${iv.toString('hex')}:\${authTag.toString('hex')}:\${encrypted}\`
  }

  decrypt(encrypted: string): string {
    const [ivHex, authTagHex, encryptedText] = encrypted.split(':')
    
    const iv = Buffer.from(ivHex, 'hex')
    const authTag = Buffer.from(authTagHex, 'hex')
    const decipher = crypto.createDecipheriv(this.algorithm, this.key, iv)
    
    decipher.setAuthTag(authTag)
    
    let decrypted = decipher.update(encryptedText, 'hex', 'utf8')
    decrypted += decipher.final('utf8')
    
    return decrypted
  }
}
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

```typescript
// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
const encryptedKey = encryptionService.encrypt(apiKey)
await prisma.apiKey.create({
  data: { userId, provider, encryptedKey }
})

// ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ
const record = await prisma.apiKey.findFirst({
  where: { userId, provider }
})
const apiKey = encryptionService.decrypt(record.encryptedKey)
```

### Best Practices

**1. SQL Injection**
- Prisma ORM (Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹)
- Zod Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

**2. XSS**
- React Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞºÑ€Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ JSX
- CSP headers

**3. CORS**
```typescript
fastify.register(cors, {
  origin: 'https://promptyflow.com',
  credentials: true
})
```

**4. Rate Limiting**
```typescript
fastify.register(rateLimit, {
  max: 100,
  timeWindow: '1 minute'
})
```

---

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### Frontend Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**1. Code Splitting**

```typescript
const LandingPage = lazy(() => import('./pages/LandingPage'))
const DashboardPage = lazy(() => import('./pages/DashboardPage'))
```

**2. Memoization**

```typescript
const stats = useMemo(() => {
  return blocks.map(block => ({
    ...block,
    totalChars: calculateTotalChars(block)
  }))
}, [blocks])
```

**3. Debouncing**

```typescript
const debouncedSave = useMemo(
  () => debounce((data) => save(data), 500),
  []
)
```

### Backend Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**1. Database Indexes**

- B-tree Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹: `user_id`, `updated_at`
- GIN Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹: full-text search Ğ½Ğ° `name_tsv`, `content_tsv`

**2. Redis Caching**

- AI models: 1 Ñ‡Ğ°Ñ TTL
- User sessions: 7 Ğ´Ğ½ĞµĞ¹ TTL

**3. Full-Text Search**

Ğ”Ğ¾: 7-8 ÑĞµĞºÑƒĞ½Ğ´  
ĞŸĞ¾ÑĞ»Ğµ: 1-11ms (700x Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ)

**4. Connection Pooling**

- Prisma: 20 connections pool
- PgBouncer Ğ´Ğ»Ñ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

---

## ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ

### Horizontal Scaling

```
               Nginx Load Balancer
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
   Backend 1      Backend 2      Backend 3
   (Fastify)      (Fastify)      (Fastify)
        â”‚              â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚
            â–¼                     â–¼
       PostgreSQL             Redis
        (Primary)            (Cluster)
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚
     â–¼             â–¼
  Replica 1    Replica 2
 (Read-only)  (Read-only)
```

### Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CACHE LAYERS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ L1: Browser (React Query)  5-15 min        â”‚
â”‚     â€¢ Projects, templates, AI models       â”‚
â”‚                                            â”‚
â”‚ L2: Redis (Backend)        1-24 hours      â”‚
â”‚     â€¢ AI models, sessions, rate limits     â”‚
â”‚                                            â”‚
â”‚ L3: PostgreSQL             Permanent       â”‚
â”‚     â€¢ Users, projects, templates, keys     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Scaling

**1. Read Replicas**

```typescript
const prismaWrite = new PrismaClient({ url: PRIMARY_URL })
const prismaRead = new PrismaClient({ url: REPLICA_URL })

// Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ
const projects = await prismaRead.project.findMany()

// Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ
await prismaWrite.project.create()
```

**2. Sharding (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)**

Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ `user_id` Ñ consistent hashing.

**3. PgBouncer**

Connection pooling Ğ´Ğ»Ñ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹.

---

**Ğ”Ğ°Ñ‚Ğ°:** 05.12.2025  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 3.0  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ
