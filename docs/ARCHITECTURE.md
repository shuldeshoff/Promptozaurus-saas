# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° PromptyFlow SaaS

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹)
2. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°](#ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
3. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Frontend](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-frontend)
4. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Backend](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-backend)
5. [ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ¿Ğ¾Ñ‚Ğ¾Ğº-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
6. [Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)
7. [ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ)
8. [ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ](#Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ)
9. [Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ±Ğ°Ğ·Ğ°-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
10. [AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ](#ai-Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ)

---

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

PromptyFlow â€” ÑÑ‚Ğ¾ **Ğ¼Ğ¾Ğ½Ğ¾Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹** Ğ½Ğ° TypeScript, ÑĞ¾ÑÑ‚Ğ¾ÑÑ‰Ğ¸Ğ¹ Ğ¸Ğ· Ñ‚Ñ€Ñ‘Ñ… Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²:

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PromptyFlow SaaS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Frontend    â”‚      Backend         â”‚       Shared         â”‚
â”‚  (apps/web)   â”‚     (apps/api)       â”‚   (packages/shared)  â”‚
â”‚               â”‚                      â”‚                      â”‚
â”‚  React + Vite â”‚  Fastify + Prisma    â”‚   Types + Schemas    â”‚
â”‚  TypeScript   â”‚    TypeScript        â”‚     TypeScript       â”‚
â”‚  TanStack     â”‚    PostgreSQL        â”‚        Zod           â”‚
â”‚   Query       â”‚      Redis           â”‚                      â”‚
â”‚               â”‚                      â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

**Frontend (apps/web):**
- **Ğ¤Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº:** React 18.3 + Vite 5.4
- **Ğ¯Ğ·Ñ‹Ğº:** TypeScript 5.6
- **Ğ¡Ñ‚Ğ¸Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:** Tailwind CSS 3.4
- **Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼:** 
  - TanStack Query (server state) - ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
  - Zustand (client state) - Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
- **i18n:** react-i18next 15+ (Ñ€ÑƒÑÑĞºĞ¸Ğ¹/Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹)
- **HTTP:** Axios 1.7
- **Routing:** React Router 6
- **UI Components:**
  - @dnd-kit (drag-and-drop)
  - react-syntax-highlighter (Ğ¿Ğ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ¾Ğ´Ğ°)
  - react-hot-toast (ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ)

**Backend (apps/api):**
- **Ğ¤Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€Ğº:** Fastify 4.28
- **Ğ¯Ğ·Ñ‹Ğº:** TypeScript 5.6
- **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:** PostgreSQL 14+ (Prisma ORM 5.22)
- **ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** Redis 7+
- **ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ:** Google OAuth 2.0 + JWT
- **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ:** AES-256-GCM ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ API ĞºĞ»ÑÑ‡ĞµĞ¹
- **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** Winston
- **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ:** Zod schemas

**Shared (packages/shared):**
- **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ:** Zod schemas Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
- **Ğ¢Ğ¸Ğ¿Ñ‹:** TypeScript interfaces, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ Ğ½Ğ° frontend Ğ¸ backend

**AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹:**
- OpenAI (GPT-4, GPT-4o, GPT-5.1)
- Anthropic (Claude 3.5, Claude 4, Claude 4.5)
- Google Gemini (1.5/2.5 Flash, Pro)
- X.AI Grok (Grok Beta, Grok Vision)
- OpenRouter (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ‚Ğ¾Ñ€ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹)

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

\`\`\`
Promptozaurus-saas/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                          # Frontend Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/           # React ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout/           # ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¼Ğ°ĞºĞµÑ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx              # Ğ¨Ğ°Ğ¿ĞºĞ° Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸ĞµĞ¹
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MainLayout.tsx          # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ layout
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NavigationPanel.tsx     # ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ context/          # UI Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ContextEditor.tsx       # Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ContextItem.tsx         # Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SplitModal.tsx          # ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ° Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ prompt/           # UI Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ğ¼Ğ¸
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PromptEditor.tsx        # Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PromptItem.tsx          # Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ context-selection/ # Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ContextSelectionPanel.tsx  # Drag-select Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ui/               # ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ UI ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIConfigModal.tsx           # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ AI
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AIResponseModal.tsx         # ĞÑ‚Ğ²ĞµÑ‚Ñ‹ AI
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectList.tsx             # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ConfirmationModal.tsx       # ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ° Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/                # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LandingPage.tsx             # Ğ›ĞµĞ½Ğ´Ğ¸Ğ½Ğ³ Ğ´Ğ»Ñ Ğ³Ğ¾ÑÑ‚ĞµĞ¹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx           # Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthCallbackPage.tsx        # OAuth callback
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ErrorPage.tsx               # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/                # ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ React Ñ…ÑƒĞºĞ¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts                  # ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useProjects.ts              # CRUD Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAI.ts                    # AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAIModels.ts              # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useProjectUpdate.ts         # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useTemplates.ts             # Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
â”‚   â”‚   â”‚   â”œâ”€â”€ context/              # React Context Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EditorContext.tsx           # Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ğ°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ConfirmationContext.tsx     # ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ store/                # Zustand Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğ°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.store.ts               # User, tokens, login/logout
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ offline.store.ts            # Offline mode
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/                  # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts                      # Axios instance Ñ interceptors
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ queryClient.ts              # TanStack Query ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ i18n.ts                     # i18next ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”‚   â”œâ”€â”€ locales/              # ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ (ru/en)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ru/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ common.json             # ĞĞ±Ñ‰Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ editor.json             # Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ aiConfig.json           # AI Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ providers.json          # ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ en/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ (Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°)
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/                # Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ nameGenerators.ts           # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ contextCalculations.ts      # ĞŸĞ¾Ğ´ÑÑ‡ĞµÑ‚ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ textProcessing.ts           # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ‚ĞµĞºÑÑ‚Ğ°
â”‚   â”‚   â”‚   â””â”€â”€ data/                 # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
â”‚   â”‚   â”‚       â””â”€â”€ quickHelp.ts                # Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ ÑĞ¿Ñ€Ğ°Ğ²ĞºĞ°
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ vite.config.ts                      # Vite ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ tailwind.config.js                  # Tailwind Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ api/                          # Backend Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.ts                        # Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Fastify
â”‚       â”‚   â”œâ”€â”€ routes/               # API endpoints
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.routes.ts              # /auth/* - OAuth, JWT
â”‚       â”‚   â”‚   â”œâ”€â”€ project.routes.ts           # /api/projects/* - CRUD Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
â”‚       â”‚   â”‚   â”œâ”€â”€ context.routes.ts           # /api/projects/:id/context-blocks
â”‚       â”‚   â”‚   â”œâ”€â”€ prompt.routes.ts            # /api/projects/:id/prompt-blocks
â”‚       â”‚   â”‚   â”œâ”€â”€ template.routes.ts          # /api/templates/* - Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°
â”‚       â”‚   â”‚   â”œâ”€â”€ ai.routes.ts                # /ai/* - AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
â”‚       â”‚   â”‚   â””â”€â”€ user.routes.ts              # /api/user/* - Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ, API ĞºĞ»ÑÑ‡Ğ¸
â”‚       â”‚   â”œâ”€â”€ services/             # Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
â”‚       â”‚   â”‚   â”œâ”€â”€ project.service.ts          # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°Ğ¼Ğ¸
â”‚       â”‚   â”‚   â”œâ”€â”€ template.service.ts         # Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
â”‚       â”‚   â”‚   â”œâ”€â”€ user.service.ts             # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
â”‚       â”‚   â”‚   â”œâ”€â”€ modelsCache.service.ts      # ĞšĞµÑˆ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ AI
â”‚       â”‚   â”‚   â””â”€â”€ encryption.service.ts       # Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡ĞµĞ¹
â”‚       â”‚   â”œâ”€â”€ providers/            # AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹
â”‚       â”‚   â”‚   â”œâ”€â”€ base.provider.ts            # ĞĞ±ÑÑ‚Ñ€Ğ°ĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ
â”‚       â”‚   â”‚   â”œâ”€â”€ openai.provider.ts          # OpenAI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
â”‚       â”‚   â”‚   â”œâ”€â”€ anthropic.provider.ts       # Anthropic Claude
â”‚       â”‚   â”‚   â”œâ”€â”€ gemini.provider.ts          # Google Gemini
â”‚       â”‚   â”‚   â”œâ”€â”€ grok.provider.ts            # X.AI Grok
â”‚       â”‚   â”‚   â””â”€â”€ openrouter.provider.ts      # OpenRouter
â”‚       â”‚   â”œâ”€â”€ middleware/           # Fastify middleware
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts          # JWT Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
â”‚       â”‚   â”‚   â”œâ”€â”€ errorHandler.ts             # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
â”‚       â”‚   â”‚   â””â”€â”€ cors.ts                     # CORS Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸
â”‚       â”‚   â”œâ”€â”€ lib/                  # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
â”‚       â”‚   â”‚   â”œâ”€â”€ prisma.ts                   # Prisma client singleton
â”‚       â”‚   â”‚   â”œâ”€â”€ redis.ts                    # Redis client
â”‚       â”‚   â”‚   â””â”€â”€ logger.ts                   # Winston logger
â”‚       â”‚   â””â”€â”€ utils/                # Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
â”‚       â”‚       â””â”€â”€ prompt.utils.ts             # ĞšĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ²
â”‚       â”œâ”€â”€ prisma/
â”‚       â”‚   â”œâ”€â”€ schema.prisma                   # Ğ¡Ñ…ĞµĞ¼Ğ° Ğ‘Ğ”
â”‚       â”‚   â””â”€â”€ migrations/                     # SQL Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
â”‚       â”‚       â””â”€â”€ YYYYMMDDHHMMSS_description/
â”‚       â”‚           â””â”€â”€ migration.sql
â”‚       â”œâ”€â”€ scripts/                  # Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°Ñ€Ğ½Ñ‹Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹
â”‚       â”‚   â””â”€â”€ generate-encryption-key.ts      # Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
â”‚       â””â”€â”€ package.json
â”‚
â””â”€â”€ packages/
    â””â”€â”€ shared/                       # ĞĞ±Ñ‰Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ¸ ÑÑ…ĞµĞ¼Ñ‹
        â”œâ”€â”€ src/
        â”‚   â”œâ”€â”€ types.ts                        # TypeScript interfaces
        â”‚   â”œâ”€â”€ schemas.ts                      # Zod validation schemas
        â”‚   â””â”€â”€ index.ts
        â””â”€â”€ package.json
\`\`\`

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Frontend

### Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²

\`\`\`
App.tsx
â”œâ”€â”€ ErrorBoundary                     # ĞŸĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº React
â”‚   â””â”€â”€ QueryClientProvider           # TanStack Query provider
â”‚       â””â”€â”€ ConfirmationProvider      # Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ¸ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ
â”‚           â”œâ”€â”€ LandingPage           # Ğ”Ğ»Ñ Ğ½ĞµĞ·Ğ°Ğ»Ğ¾Ğ³Ğ¸Ğ½ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
â”‚           â”‚   â”œâ”€â”€ Header (guest mode)
â”‚           â”‚   â”œâ”€â”€ Hero section
â”‚           â”‚   â”œâ”€â”€ Features
â”‚           â”‚   â””â”€â”€ Footer
â”‚           â”‚
â”‚           â””â”€â”€ DashboardPage         # Ğ”Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
â”‚               â””â”€â”€ EditorProvider    # ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ğ°
â”‚                   â””â”€â”€ MainLayout
â”‚                       â”œâ”€â”€ Header (authorized mode)
â”‚                       â”‚   â”œâ”€â”€ Project selector
â”‚                       â”‚   â”œâ”€â”€ AI config button
â”‚                       â”‚   â”œâ”€â”€ Language switcher
â”‚                       â”‚   â””â”€â”€ User menu
â”‚                       â”‚
â”‚                       â”œâ”€â”€ NavigationPanel (left sidebar)
â”‚                       â”‚   â”œâ”€â”€ ProjectList
â”‚                       â”‚   â”œâ”€â”€ "Create project" button
â”‚                       â”‚   â””â”€â”€ Project cards with stats
â”‚                       â”‚
â”‚                       â”œâ”€â”€ BlocksPanel (middle panel)
â”‚                       â”‚   â”œâ”€â”€ Tabs: Context | Prompts
â”‚                       â”‚   â”œâ”€â”€ Context blocks list
â”‚                       â”‚   â”œâ”€â”€ Prompt blocks list
â”‚                       â”‚   â””â”€â”€ "Create block" button
â”‚                       â”‚
â”‚                       â””â”€â”€ EditorPanel (right panel)
â”‚                           â”œâ”€â”€ ContextEditor
â”‚                           â”‚   â”œâ”€â”€ Block title
â”‚                           â”‚   â”œâ”€â”€ Items list (drag-and-drop)
â”‚                           â”‚   â”œâ”€â”€ SubItems (nested)
â”‚                           â”‚   â”œâ”€â”€ Split modal
â”‚                           â”‚   â””â”€â”€ Export button
â”‚                           â”‚
â”‚                           â””â”€â”€ PromptEditor
â”‚                               â”œâ”€â”€ Template textarea
â”‚                               â”œâ”€â”€ ContextSelectionPanel
â”‚                               â”œâ”€â”€ Compiled prompt preview
â”‚                               â””â”€â”€ AI send button
\`\`\`

### Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼

**1. Server State (TanStack Query)**

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ:

\`\`\`typescript
// apps/web/src/hooks/useProjects.ts
export const useProjects = () => {
  return useQuery({
    queryKey: ['projects'],
    queryFn: async () => {
      const response = await api.get('/api/projects')
      return response.data.data as Project[]
    },
    staleTime: 5 * 60 * 1000, // 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
    cacheTime: 10 * 60 * 1000, // 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
  })
}

export const useProject = (id: string) => {
  return useQuery({
    queryKey: ['projects', id],
    queryFn: async () => {
      const response = await api.get(\`/api/projects/\${id}\`)
      return response.data.data as Project
    },
    enabled: !!id, // Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ id Ğ·Ğ°Ğ´Ğ°Ğ½
  })
}

export const useUpdateProject = () => {
  const queryClient = useQueryClient()
  
  return useMutation({
    mutationFn: async ({ id, data }: { id: string; data: any }) => {
      const response = await api.patch(\`/api/projects/\${id}\`, { data })
      return response.data.data
    },
    onSuccess: (updatedProject) => {
      // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞµÑˆ
      queryClient.invalidateQueries(['projects'])
      queryClient.setQueryData(['projects', updatedProject.id], updatedProject)
    },
  })
}
\`\`\`

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° TanStack Query:**
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
- Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (refetching)
- Optimistic updates
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ retry Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…
- Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

**2. Client State (Zustand)**

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ:

\`\`\`typescript
// apps/web/src/store/auth.store.ts
interface AuthStore {
  user: User | null
  accessToken: string | null
  refreshToken: string | null
  login: (tokens: Tokens, user: User) => void
  logout: () => void
  updateToken: (accessToken: string) => void
}

export const useAuthStore = create<AuthStore>((set) => ({
  user: null,
  accessToken: null,
  refreshToken: null,
  
  login: (tokens, user) => {
    set({ 
      accessToken: tokens.accessToken,
      refreshToken: tokens.refreshToken,
      user 
    })
  },
  
  logout: () => {
    set({ user: null, accessToken: null, refreshToken: null })
  },
  
  updateToken: (accessToken) => {
    set({ accessToken })
  },
}))
\`\`\`

**3. Context API**

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ UI ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾ Ğ² Ğ´ĞµÑ€ĞµĞ²Ğ¾ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²:

\`\`\`typescript
// apps/web/src/context/EditorContext.tsx
interface EditorContextType {
  activeTab: 'context' | 'prompts'
  setActiveTab: (tab: 'context' | 'prompts') => void
  activeContextBlockId: number | null
  setActiveContextBlockId: (id: number | null) => void
  activePromptBlockId: number | null
  setActivePromptBlockId: (id: number | null) => void
  expandedItems: Set<number>
  toggleItemExpanded: (id: number) => void
}

export const EditorProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [activeTab, setActiveTab] = useState<'context' | 'prompts'>('context')
  const [activeContextBlockId, setActiveContextBlockId] = useState<number | null>(null)
  const [activePromptBlockId, setActivePromptBlockId] = useState<number | null>(null)
  const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set())

  const toggleItemExpanded = (id: number) => {
    setExpandedItems(prev => {
      const next = new Set(prev)
      if (next.has(id)) {
        next.delete(id)
      } else {
        next.add(id)
      }
      return next
    })
  }

  return (
    <EditorContext.Provider value={{
      activeTab, setActiveTab,
      activeContextBlockId, setActiveContextBlockId,
      activePromptBlockId, setActivePromptBlockId,
      expandedItems, toggleItemExpanded,
    }}>
      {children}
    </EditorContext.Provider>
  )
}
\`\`\`

**4. Local Component State (useState)**

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°:

\`\`\`typescript
// ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ² ContextEditor.tsx
const [editingName, setEditingName] = useState(false)
const [isModalOpen, setIsModalOpen] = useState(false)
const [localTitle, setLocalTitle] = useState(block.title)
\`\`\`

### ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Frontend

**1. Optimistic Updates (Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ)**

ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ UI Ğ´Ğ¾ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ¾Ñ‚ ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ´Ğ»Ñ Ğ»ÑƒÑ‡ÑˆĞµĞ³Ğ¾ UX:

\`\`\`typescript
const updateProjectMutation = useMutation({
  mutationFn: async ({ id, data }) => {
    return await api.patch(\`/api/projects/\${id}\`, { data })
  },
  
  onMutate: async (newData) => {
    // ĞÑ‚Ğ¼ĞµĞ½ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ refetch Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
    await queryClient.cancelQueries(['projects', newData.id])
    
    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ°
    const previousProject = queryClient.getQueryData(['projects', newData.id])
    
    // ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞµÑˆ
    queryClient.setQueryData(['projects', newData.id], (old: any) => ({
      ...old,
      ...newData.data,
    }))
    
    return { previousProject }
  },
  
  onError: (err, newData, context) => {
    // ĞÑ‚ĞºĞ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
    if (context?.previousProject) {
      queryClient.setQueryData(['projects', newData.id], context.previousProject)
    }
    toast.error('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ')
  },
  
  onSuccess: (data, variables) => {
    // Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
    queryClient.invalidateQueries(['projects'])
  },
})
\`\`\`

**2. Debounced Auto-Save (Ğ°Ğ²Ñ‚Ğ¾ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹)**

ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ»Ğ¸ÑˆĞ½Ğ¸Ñ… API Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¿Ñ€Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¼ Ğ²Ğ²Ğ¾Ğ´Ğµ:

\`\`\`typescript
import { debounce } from 'lodash'

const PromptEditor = ({ block }) => {
  const updateProject = useProjectUpdate()
  const [localTitle, setLocalTitle] = useState(block.title)
  
  // Debounced Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ (Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğµ Ñ‡Ğ°Ñ‰Ğµ Ñ€Ğ°Ğ·Ğ° Ğ² 500Ğ¼Ñ)
  const debouncedSave = useMemo(
    () => debounce((title: string) => {
      updateProject.mutate({
        id: block.id,
        data: { title }
      })
    }, 500),
    [block.id]
  )
  
  const handleTitleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const newTitle = e.target.value
    setLocalTitle(newTitle)  // ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ UI
    debouncedSave(newTitle)  // ĞÑ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
  }
  
  return <input value={localTitle} onChange={handleTitleChange} />
}
\`\`\`

**3. Offline Support (Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¾Ñ„Ñ„Ğ»Ğ°Ğ¹Ğ½ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°)**

Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾, ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ ÑĞµÑ‚Ğ¸:

\`\`\`typescript
// apps/web/src/hooks/useProjectUpdate.ts
export const useProjectUpdate = () => {
  const queryClient = useQueryClient()
  const offlineStore = useOfflineStore()

  return useMutation({
    mutationFn: async (data) => {
      const response = await api.patch(\`/api/projects/\${data.id}\`, data)
      return response.data.data
    },
    
    onError: (error: any, variables) => {
      if (!navigator.onLine) {
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² localStorage Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ·Ğ¶Ğµ
        offlineStore.addPendingChange({
          type: 'project_update',
          data: variables,
          timestamp: Date.now(),
        })
        toast.info('ĞĞµÑ‚ ÑĞµÑ‚Ğ¸. Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾.')
      } else {
        toast.error('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ')
      }
    },
  })
}
\`\`\`

**4. Error Boundary (Ğ¿ĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº React)**

\`\`\`typescript
// apps/web/src/components/ErrorBoundary.tsx
class ErrorBoundary extends React.Component<Props, State> {
  state = { hasError: false, error: null }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error }
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('React Error:', error, errorInfo)
    // ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ° Sentry/LogRocket
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="error-fallback">
          <h1>Ğ§Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ¿Ğ¾ÑˆĞ»Ğ¾ Ğ½Ğµ Ñ‚Ğ°Ğº</h1>
          <button onClick={() => window.location.reload()}>
            ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ
          </button>
        </div>
      )
    }

    return this.props.children
  }
}
\`\`\`

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Backend

### Ğ¡Ğ»Ğ¾Ğ¸ÑÑ‚Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

Backend Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñƒ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğ° ÑĞ»Ğ¾Ğ¸:

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ROUTES LAYER                            â”‚
â”‚  â€¢ HTTP Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                                        â”‚
â”‚  â€¢ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Zod schemas)                          â”‚
â”‚  â€¢ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº                                          â”‚
â”‚  â€¢ Middleware (auth, CORS, rate limiting)                    â”‚
â”‚  Ğ¤Ğ°Ğ¹Ğ»Ñ‹: auth.routes.ts, project.routes.ts, etc.            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SERVICE LAYER                            â”‚
â”‚  â€¢ Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ                                  â”‚
â”‚  â€¢ ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°)                       â”‚
â”‚  â€¢ Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…                                      â”‚
â”‚  â€¢ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»                                   â”‚
â”‚  Ğ¤Ğ°Ğ¹Ğ»Ñ‹: projectService, templateService, userService         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATA ACCESS LAYER                          â”‚
â”‚  â€¢ ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Prisma)                          â”‚
â”‚  â€¢ ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Redis)                                       â”‚
â”‚  â€¢ Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ API (AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹)                              â”‚
â”‚  â€¢ Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ/Ğ´ĞµÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ                                   â”‚
â”‚  Ğ¤Ğ°Ğ¹Ğ»Ñ‹: prisma.ts, redis.ts, providers/                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### RESTful API ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

\`\`\`
ğŸ“ /auth/*                            # ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
  POST   /auth/google                 # Google OAuth callback
  POST   /auth/refresh                # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ access token
  
ğŸ“ /api/user                          # ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  GET    /api/user                    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
  PATCH  /api/user                    # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
  POST   /api/user/api-keys/:provider # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ API ĞºĞ»ÑÑ‡
  DELETE /api/user/api-keys/:provider # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ API ĞºĞ»ÑÑ‡
  GET    /api/user/api-keys           # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ñ… ĞºĞ»ÑÑ‡ĞµĞ¹
  
ğŸ“ /api/projects                      # CRUD Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ²
  GET    /api/projects                # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  POST   /api/projects                # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
  GET    /api/projects/:id            # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ¿Ğ¾ ID
  PATCH  /api/projects/:id            # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
  DELETE /api/projects/:id            # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
  
ğŸ“ /api/projects/:id/context-blocks   # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
  PATCH  /api/projects/:id/context-blocks        # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ»Ğ¾ĞºĞ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
  GET    /api/projects/:id/context-blocks/stats  # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° (ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹, ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹)
  
ğŸ“ /api/projects/:id/prompt-blocks    # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ğ¼Ğ¸
  PATCH  /api/projects/:id/prompt-blocks         # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ²
  POST   /api/projects/:id/prompt-blocks/compile # Ğ¡ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚
  
ğŸ“ /api/templates                     # Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
  GET    /api/templates               # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  GET    /api/templates/search?q=     # ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°Ğ¼ (full-text search)
  POST   /api/templates               # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½
  PATCH  /api/templates/:id           # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½
  DELETE /api/templates/:id           # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½
  
ğŸ“ /ai/*                              # AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
  GET    /ai/models                   # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
  POST   /ai/send                     # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº AI
  POST   /ai/test-connection          # Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ API ĞºĞ»ÑÑ‡ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
\`\`\`

### Service Layer (ÑĞ»Ğ¾Ğ¹ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²)

Ğ’ÑÑ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¸Ğ½ĞºĞ°Ğ¿ÑÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ñ…:

\`\`\`typescript
// apps/api/src/services/project.service.ts
class ProjectService {
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
   */
  async getUserProjects(userId: string): Promise<Project[]> {
    return await prisma.project.findMany({
      where: { userId },
      orderBy: { updatedAt: 'desc' },
      select: {
        id: true,
        name: true,
        data: true,
        createdAt: true,
        updatedAt: true,
      }
    })
  }

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ¿Ğ¾ ID Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
   */
  async getProjectById(projectId: string, userId: string): Promise<Project | null> {
    const project = await prisma.project.findFirst({
      where: {
        id: projectId,
        userId, // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°, Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ¸Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
      },
    })
    
    if (!project) {
      throw new Error('ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ¸Ğ»Ğ¸ Ñƒ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°')
    }
    
    return project
  }

  /**
   * ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸ĞµĞ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°
   */
  async updateProject(
    projectId: string, 
    userId: string, 
    input: UpdateProjectInput
  ): Promise<Project> {
    // 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
    const project = await this.getProjectById(projectId, userId)
    
    // 2. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
    if (input.data) {
      const sizeValidation = this.validateProjectSize(input.data)
      if (!sizeValidation.valid) {
        throw new Error(sizeValidation.error)
      }
    }
    
    // 3. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ² Ğ‘Ğ”
    return await prisma.project.update({
      where: { id: projectId },
      data: {
        ...input,
        updatedAt: new Date(),
      }
    })
  }

  /**
   * Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
   */
  validateProjectSize(data: ProjectData): { valid: boolean; error?: string } {
    const MAX_PROJECT_SIZE = 10_000_000 // 10M ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
    const MAX_BLOCK_SIZE = 5_000_000   // 5M ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²

    const { totalChars, largestBlockChars } = this.calculateProjectSize(data)

    if (largestBlockChars > MAX_BLOCK_SIZE) {
      return {
        valid: false,
        error: \`Ğ‘Ğ»Ğ¾Ğº ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ (\${largestBlockChars.toLocaleString()} / \${MAX_BLOCK_SIZE.toLocaleString()} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)\`
      }
    }

    if (totalChars > MAX_PROJECT_SIZE) {
      return {
        valid: false,
        error: \`ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ (\${totalChars.toLocaleString()} / \${MAX_PROJECT_SIZE.toLocaleString()} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)\`
      }
    }

    return { valid: true }
  }

  /**
   * ĞŸĞ¾Ğ´ÑÑ‡ĞµÑ‚ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
   */
  calculateProjectSize(data: ProjectData): ProjectSizeInfo {
    let totalChars = 0
    let largestBlockChars = 0

    // ĞŸĞ¾Ğ´ÑÑ‡ĞµÑ‚ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ² Ğ±Ğ»Ğ¾ĞºĞ°Ñ… ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
    for (const block of data.contextBlocks || []) {
      let blockChars = 0

      for (const item of block.items || []) {
        // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ subItems, ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ñ…
        if (item.subItems && item.subItems.length > 0) {
          const subItemsChars = item.subItems.reduce(
            (sum, sub) => sum + (sub.chars || 0), 
            0
          )
          blockChars += subItemsChars
        } else {
          // Ğ˜Ğ½Ğ°Ñ‡Ğµ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ chars ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°
          blockChars += item.chars || 0
        }
      }

      totalChars += blockChars
      largestBlockChars = Math.max(largestBlockChars, blockChars)
    }

    return { totalChars, largestBlockChars }
  }

  /**
   * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
   */
  async createProject(userId: string, name: string): Promise<Project> {
    return await prisma.project.create({
      data: {
        userId,
        name,
        data: {
          contextBlocks: [],
          promptBlocks: [],
        },
      },
    })
  }

  /**
   * Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
   */
  async deleteProject(projectId: string, userId: string): Promise<void> {
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
    await this.getProjectById(projectId, userId)
    
    // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼
    await prisma.project.delete({
      where: { id: projectId },
    })
  }
}

export const projectService = new ProjectService()
\`\`\`

### Provider Pattern (Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ AI)

Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°Ğ¼Ğ¸:

\`\`\`typescript
// apps/api/src/providers/base.provider.ts
export interface AIModel {
  id: string
  name: string
  provider: string
  contextWindow: number
  maxOutputTokens?: number
}

export interface SendMessageOptions {
  apiKey: string
  model: string
  messages: Array<{ role: string; content: string }>
  temperature?: number
  maxTokens?: number
  stream?: boolean
}

export abstract class BaseProvider {
  protected apiKey: string
  protected baseUrl: string

  constructor(apiKey?: string) {
    this.apiKey = apiKey || ''
    this.baseUrl = this.getDefaultBaseUrl()
  }

  protected abstract getDefaultBaseUrl(): string

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹
   */
  abstract getModels(apiKey?: string): Promise<AIModel[]>

  /**
   * ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² AI
   */
  abstract sendMessage(options: SendMessageOptions): Promise<string>

  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ (Ñ‚ĞµÑÑ‚ API ĞºĞ»ÑÑ‡Ğ°)
   */
  abstract testConnection(apiKey: string): Promise<boolean>

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ fallback Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (ĞµÑĞ»Ğ¸ API Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)
   */
  protected getFallbackModels(): AIModel[] {
    return []
  }
}
\`\`\`

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:

\`\`\`typescript
// apps/api/src/providers/openai.provider.ts
export class OpenAIProvider extends BaseProvider {
  protected getDefaultBaseUrl(): string {
    return 'https://api.openai.com'
  }

  protected getFallbackModels(): AIModel[] {
    return [
      { id: 'gpt-4o', name: 'GPT-4o', provider: 'openai', contextWindow: 128000 },
      { id: 'gpt-4o-mini', name: 'GPT-4o Mini', provider: 'openai', contextWindow: 128000 },
      { id: 'gpt-4-turbo', name: 'GPT-4 Turbo', provider: 'openai', contextWindow: 128000 },
      { id: 'gpt-3.5-turbo', name: 'GPT-3.5 Turbo', provider: 'openai', contextWindow: 16385 },
      { id: 'gpt-5.1-chat-latest', name: 'GPT-5.1 Chat', provider: 'openai', contextWindow: 200000 },
    ]
  }

  async getModels(apiKey?: string): Promise<AIModel[]> {
    if (!apiKey) return this.getFallbackModels()

    try {
      const response = await fetch(\`\${this.baseUrl}/v1/models\`, {
        headers: { 'Authorization': \`Bearer \${apiKey}\` }
      })

      if (!response.ok) {
        return this.getFallbackModels()
      }

      const data = await response.json()
      return data.data
        .filter((m: any) => m.id.startsWith('gpt'))
        .map((m: any) => ({
          id: m.id,
          name: m.id,
          provider: 'openai',
          contextWindow: this.getContextWindow(m.id),
        }))
    } catch (error) {
      return this.getFallbackModels()
    }
  }

  async sendMessage(options: SendMessageOptions): Promise<string> {
    const { apiKey, model, messages, temperature = 0.7, maxTokens = 4000 } = options

    // GPT-5.1 Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ endpoint
    const isGpt5 = model.startsWith('gpt-5')
    const endpoint = isGpt5 ? '/v1/responses' : '/v1/chat/completions'

    // Ğ”Ğ»Ñ GPT-5.1 Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ
    const requestBody = isGpt5 
      ? {
          model,
          input: messages.map(m => m.content).join('\n\n'),
          temperature,
          max_output_tokens: maxTokens,
        }
      : {
          model,
          messages,
          temperature,
          max_tokens: maxTokens,
        }

    const response = await fetch(\`\${this.baseUrl}\${endpoint}\`, {
      method: 'POST',
      headers: {
        'Authorization': \`Bearer \${apiKey}\`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(requestBody),
    })

    if (!response.ok) {
      const errorData = await response.json()
      throw new Error(errorData.error?.message || 'OpenAI API error')
    }

    const data = await response.json()

    // Ğ Ğ°Ğ·Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ´Ğ»Ñ GPT-5.1
    if (isGpt5) {
      const messageOutput = data.output?.find((item: any) => item.type === 'message')
      const textContent = messageOutput?.content?.find((c: any) => c.type === 'output_text')?.text
      return textContent || ''
    }

    return data.choices[0]?.message?.content || ''
  }

  async testConnection(apiKey: string): Promise<boolean> {
    try {
      await this.getModels(apiKey)
      return true
    } catch {
      return false
    }
  }

  private getContextWindow(modelId: string): number {
    if (modelId.includes('gpt-5')) return 200000
    if (modelId.includes('gpt-4')) return 128000
    if (modelId.includes('gpt-3.5')) return 16385
    return 4096
  }
}
\`\`\`

### Middleware (Ğ¿Ñ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¾Ğµ ĞŸĞ)

**1. Authentication Middleware**

\`\`\`typescript
// apps/api/src/middleware/auth.middleware.ts
import { FastifyRequest, FastifyReply } from 'fastify'
import jwt from 'jsonwebtoken'

export async function authenticate(
  request: FastifyRequest,
  reply: FastifyReply
) {
  try {
    const authHeader = request.headers.authorization
    
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return reply.code(401).send({ error: 'Unauthorized' })
    }
    
    const token = authHeader.substring(7)
    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as JWTPayload
    
    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ user Ğ² request
    request.user = {
      userId: decoded.userId,
      email: decoded.email,
    }
  } catch (error) {
    return reply.code(401).send({ error: 'Invalid token' })
  }
}
\`\`\`

**2. Error Handler**

\`\`\`typescript
// apps/api/src/middleware/errorHandler.ts
export function errorHandler(
  error: Error,
  request: FastifyRequest,
  reply: FastifyReply
) {
  logger.error('Request error:', {
    error: error.message,
    stack: error.stack,
    url: request.url,
    method: request.method,
  })

  // Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
  if (error.message.includes('Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚')) {
    return reply.code(413).send({
      error: 'PAYLOAD_TOO_LARGE',
      message: error.message,
    })
  }

  if (error.message.includes('Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½')) {
    return reply.code(404).send({
      error: 'NOT_FOUND',
      message: error.message,
    })
  }

  // ĞĞ±Ñ‰Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°
  return reply.code(500).send({
    error: 'INTERNAL_SERVER_ERROR',
    message: 'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°',
  })
}
\`\`\`

---

## ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°

Ğ Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°.

\`\`\`
1. USER ACTION
   â”‚ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ñ‚ĞµĞºÑÑ‚ Ğ² textarea
   â”‚
   â–¼
2. COMPONENT EVENT
   â”‚ onChange={(e) => handleItemContentChange(item.id, e.target.value)}
   â”‚
   â–¼
3. DEBOUNCE (500ms)
   â”‚ ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ñ€Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¼ Ğ²Ğ²Ğ¾Ğ´Ğµ
   â”‚
   â–¼
4. COMPONENT HANDLER
   â”‚ const updatedBlocks = contextBlocks.map(block => 
   â”‚   block.id === activeBlock.id ? {
   â”‚     ...block,
   â”‚     items: block.items.map(item =>
   â”‚       item.id === itemId ? { ...item, content, chars: content.length } : item
   â”‚     )
   â”‚   } : block
   â”‚ )
   â”‚
   â–¼
5. CUSTOM HOOK (React Query mutation)
   â”‚ updateProjectMutation.mutate({ 
   â”‚   id: projectId, 
   â”‚   data: { contextBlocks: updatedBlocks } 
   â”‚ })
   â”‚
   â–¼
6. API CALL (Axios)
   â”‚ PATCH /api/projects/:id
   â”‚ Body: { data: { contextBlocks: [...] } }
   â”‚ Headers: { Authorization: 'Bearer <token>' }
   â”‚
   â–¼
7. BACKEND ROUTE (Fastify)
   â”‚ fastify.patch('/api/projects/:id', 
   â”‚   { preHandler: authenticate },
   â”‚   async (request, reply) => { ... }
   â”‚ )
   â”‚
   â–¼
8. AUTH MIDDLEWARE
   â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ JWT token
   â”‚ Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ userId Ğ¸Ğ· Ñ‚Ğ¾ĞºĞµĞ½Ğ°
   â”‚ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ request.user = { userId, email }
   â”‚
   â–¼
9. SERVICE LAYER
   â”‚ projectService.updateProject(projectId, userId, input)
   â”‚   1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° (Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ¸Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ)
   â”‚   2. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (Ğ½Ğµ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ 10M)
   â”‚   3. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° Ğ±Ğ»Ğ¾ĞºĞ° (Ğ½Ğµ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ 5M)
   â”‚
   â–¼
10. DATABASE (Prisma + PostgreSQL)
   â”‚ UPDATE projects
   â”‚ SET data = $1, updated_at = NOW()
   â”‚ WHERE id = $2 AND user_id = $3
   â”‚ RETURNING *
   â”‚
   â–¼
11. RESPONSE BACK TO CLIENT
   â”‚ { success: true, data: updatedProject }
   â”‚
   â–¼
12. REACT QUERY CACHE UPDATE
   â”‚ queryClient.setQueryData(['projects', id], updatedProject)
   â”‚ queryClient.invalidateQueries(['projects'])
   â”‚
   â–¼
13. COMPONENT RE-RENDER
   â”‚ UI Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
\`\`\`

### Optimistic Update Flow

Ğ”Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ UX Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‚ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾:

\`\`\`
USER TYPES
   â”‚
   â–¼
UI UPDATES IMMEDIATELY (local state)
   â”‚ setLocalContent(newContent)
   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                 â”‚
   â–¼                                 â–¼
OPTIMISTIC CACHE UPDATE        DEBOUNCED API CALL (500ms later)
   â”‚ queryClient.setQueryData()      â”‚
   â”‚                                 â”‚
   â”‚                                 â–¼
   â”‚                            API REQUEST
   â”‚                                 â”‚
   â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                        â”‚                 â”‚
   â”‚                        â–¼                 â–¼
   â”‚                    SUCCESS            ERROR
   â”‚                        â”‚                 â”‚
   â”‚                        â–¼                 â–¼
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> CONFIRM UPDATE    ROLLBACK UPDATE
                          â”‚                 â”‚
                          â”‚                 â–¼
                          â”‚          queryClient.setQueryData(previousValue)
                          â”‚          toast.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ')
                          â”‚
                          â–¼
                    ALL IN SYNC
\`\`\`

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Google OAuth 2.0 + JWT

**ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ flow Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸:**

\`\`\`
1. USER CLICKS "Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Google"
   â”‚
   â–¼
2. REDIRECT TO GOOGLE OAUTH
   â”‚ https://accounts.google.com/o/oauth2/v2/auth?
   â”‚   client_id=<CLIENT_ID>
   â”‚   redirect_uri=https://promptyflow.com/auth/google/callback
   â”‚   response_type=code
   â”‚   scope=openid email profile
   â”‚
   â–¼
3. USER AUTHORIZES IN GOOGLE
   â”‚ Ğ’Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ»Ğ¾Ğ³Ğ¸Ğ½/Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
   â”‚ ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº email Ğ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ
   â”‚
   â–¼
4. GOOGLE REDIRECTS BACK WITH CODE
   â”‚ https://promptyflow.com/auth/google/callback?code=<AUTHORIZATION_CODE>
   â”‚
   â–¼
5. BACKEND EXCHANGES CODE FOR TOKENS
   â”‚ POST https://oauth2.googleapis.com/token
   â”‚ Body: {
   â”‚   code: <AUTHORIZATION_CODE>,
   â”‚   client_id: <CLIENT_ID>,
   â”‚   client_secret: <CLIENT_SECRET>,
   â”‚   redirect_uri: https://promptyflow.com/auth/google/callback,
   â”‚   grant_type: 'authorization_code'
   â”‚ }
   â”‚
   â–¼
6. GOOGLE RETURNS ACCESS TOKEN
   â”‚ { access_token: '...', id_token: '...', expires_in: 3600 }
   â”‚
   â–¼
7. BACKEND FETCHES USER PROFILE
   â”‚ GET https://www.googleapis.com/oauth2/v1/userinfo
   â”‚ Headers: { Authorization: 'Bearer <access_token>' }
   â”‚
   â–¼
8. CREATE/UPDATE USER IN DATABASE
   â”‚ prisma.user.upsert({
   â”‚   where: { googleId: profile.id },
   â”‚   create: { googleId, email, name, picture },
   â”‚   update: { email, name, picture, lastLoginAt: new Date() }
   â”‚ })
   â”‚
   â–¼
9. GENERATE JWT TOKENS
   â”‚ Access Token (15 Ğ¼Ğ¸Ğ½):
   â”‚   jwt.sign({ userId, email }, JWT_SECRET, { expiresIn: '15m' })
   â”‚
   â”‚ Refresh Token (7 Ğ´Ğ½ĞµĞ¹):
   â”‚   jwt.sign({ userId }, JWT_SECRET, { expiresIn: '7d' })
   â”‚
   â–¼
10. REDIRECT TO FRONTEND WITH TOKENS
   â”‚ https://promptyflow.com/#/auth/callback?
   â”‚   access_token=<JWT_ACCESS_TOKEN>
   â”‚   &refresh_token=<JWT_REFRESH_TOKEN>
   â”‚
   â–¼
11. FRONTEND STORES TOKENS IN MEMORY
   â”‚ useAuthStore.login({ accessToken, refreshToken }, user)
   â”‚ navigate('/dashboard')
   â”‚
   â–¼
12. SUBSEQUENT API CALLS USE ACCESS TOKEN
   â”‚ axios.interceptors.request.use(config => {
   â”‚   config.headers.Authorization = \`Bearer \${accessToken}\`
   â”‚   return config
   â”‚ })
\`\`\`

**ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ¿Ñ€Ğ¸ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ğ¸:**

\`\`\`typescript
// apps/web/src/lib/api.ts
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config

    // Ğ•ÑĞ»Ğ¸ 401 Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ retry Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ°
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true

      try {
        // Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ access token
        const refreshToken = useAuthStore.getState().refreshToken
        const response = await axios.post('/auth/refresh', { refreshToken })
        
        const { accessToken } = response.data
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² store
        useAuthStore.getState().updateToken(accessToken)
        
        // ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµĞ¼ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ¼
        originalRequest.headers.Authorization = \`Bearer \${accessToken}\`
        return api(originalRequest)
      } catch (refreshError) {
        // Refresh token Ñ‚Ğ¾Ğ¶Ğµ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´ĞµĞ½ - Ñ€Ğ°Ğ·Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼
        useAuthStore.getState().logout()
        window.location.href = '/'
        return Promise.reject(refreshError)
      }
    }

    return Promise.reject(error)
  }
)
\`\`\`

### Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡ĞµĞ¹

Ğ’ÑĞµ API ĞºĞ»ÑÑ‡Ğ¸ AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ² ÑˆĞ¸Ñ„Ñ€ÑƒÑÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼ Ğ² Ğ‘Ğ”:

\`\`\`typescript
// apps/api/src/services/encryption.service.ts
import crypto from 'crypto'

class EncryptionService {
  private algorithm = 'aes-256-gcm'
  private key: Buffer

  constructor() {
    // ĞšĞ»ÑÑ‡ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ (32 Ğ±Ğ°Ğ¹Ñ‚Ğ° Ğ´Ğ»Ñ AES-256)
    const keyString = process.env.ENCRYPTION_KEY!
    this.key = Buffer.from(keyString, 'hex')
  }

  /**
   * Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°
   * Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ: iv:authTag:encrypted
   */
  encrypt(text: string): string {
    // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ initialization vector (16 Ğ±Ğ°Ğ¹Ñ‚)
    const iv = crypto.randomBytes(16)
    
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ cipher
    const cipher = crypto.createCipheriv(this.algorithm, this.key, iv)
    
    // Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑÑ‚
    let encrypted = cipher.update(text, 'utf8', 'hex')
    encrypted += cipher.final('hex')
    
    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ authentication tag (Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸)
    const authTag = cipher.getAuthTag()
    
    // Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ iv:authTag:encrypted (Ğ²ÑĞµ Ğ² hex Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ)
    return \`\${iv.toString('hex')}:\${authTag.toString('hex')}:\${encrypted}\`
  }

  /**
   * Ğ”ĞµÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°
   */
  decrypt(encrypted: string): string {
    // Ğ Ğ°Ğ·Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ½Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹
    const [ivHex, authTagHex, encryptedText] = encrypted.split(':')
    
    const iv = Buffer.from(ivHex, 'hex')
    const authTag = Buffer.from(authTagHex, 'hex')
    
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ decipher
    const decipher = crypto.createDecipheriv(this.algorithm, this.key, iv)
    decipher.setAuthTag(authTag)
    
    // Ğ”ĞµÑˆĞ¸Ñ„Ñ€ÑƒĞµĞ¼
    let decrypted = decipher.update(encryptedText, 'hex', 'utf8')
    decrypted += decipher.final('utf8')
    
    return decrypted
  }
}

export const encryptionService = new EncryptionService()
\`\`\`

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

\`\`\`typescript
// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡Ğ°
const encryptedKey = encryptionService.encrypt(apiKey)
await prisma.apiKey.create({
  data: {
    userId,
    provider: 'openai',
    encryptedKey, // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
  }
})

// ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ API ĞºĞ»ÑÑ‡Ğ°
const record = await prisma.apiKey.findFirst({
  where: { userId, provider: 'openai' }
})
const apiKey = encryptionService.decrypt(record.encryptedKey)
\`\`\`

### Security Best Practices

**1. Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ SQL Injection**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Prisma ORM (Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹)
- Ğ’ÑĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· Zod schemas

**2. Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ XSS (Cross-Site Scripting)**
- React Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞºÑ€Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ JSX
- Ğ”Ğ»Ñ HTML Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ DOMPurify
- CSP (Content Security Policy) headers

**3. CORS (Cross-Origin Resource Sharing)**
\`\`\`typescript
fastify.register(cors, {
  origin: process.env.FRONTEND_URL || 'https://promptyflow.com',
  credentials: true,
})
\`\`\`

**4. Rate Limiting**
\`\`\`typescript
fastify.register(rateLimit, {
  max: 100, // Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 100 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
  timeWindow: '1 minute', // Ğ·Ğ° 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
})
\`\`\`

**5. Input Validation (Zod)**
\`\`\`typescript
const createProjectSchema = z.object({
  name: z.string().min(1).max(100),
})

fastify.post('/api/projects', async (request, reply) => {
  const body = createProjectSchema.parse(request.body) // Throws ĞµÑĞ»Ğ¸ Ğ½ĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾
  // ...
})
\`\`\`

---

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### Frontend Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**1. Code Splitting (Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°)**

\`\`\`typescript
// apps/web/src/App.tsx
import { lazy, Suspense } from 'react'

// Ğ›ĞµĞ½Ğ¸Ğ²Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†
const LandingPage = lazy(() => import('./pages/LandingPage'))
const DashboardPage = lazy(() => import('./pages/DashboardPage'))

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<LandingPage />} />
        <Route path="/dashboard" element={<DashboardPage />} />
      </Routes>
    </Suspense>
  )
}
\`\`\`

**2. Memoization (ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğ¹)**

\`\`\`typescript
// ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ñ… Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğ¹
const contextBlocksWithStats = useMemo(() => {
  return contextBlocks.map(block => {
    const totalChars = calculateTotalChars(block)
    const totalItems = block.items.length
    const totalSubItems = block.items.reduce(
      (sum, item) => sum + (item.subItems?.length || 0), 
      0
    )

    return { ...block, totalChars, totalItems, totalSubItems }
  })
}, [contextBlocks]) // ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ contextBlocks

// ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ callback Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹
const handleItemClick = useCallback((itemId: number) => {
  setActiveItemId(itemId)
}, []) // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·
\`\`\`

**3. Debouncing (Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ)**

\`\`\`typescript
// Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ²Ğ²Ğ¾Ğ´Ğµ Ñ‚ĞµĞºÑÑ‚Ğ°
const debouncedSave = useMemo(
  () => debounce((content: string) => {
    updateProject.mutate({ data: { content } })
  }, 500),
  []
)

const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
  const newContent = e.target.value
  setLocalContent(newContent) // ĞĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ UI
  debouncedSave(newContent)   // ĞÑ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
}
\`\`\`

**4. Virtualization (Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ²)**

Ğ”Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… ÑĞ¿Ğ¸ÑĞºĞ¾Ğ² (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ):

\`\`\`typescript
import { FixedSizeList } from 'react-window'

<FixedSizeList
  height={600}
  itemCount={items.length}
  itemSize={80}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>
      <ItemComponent item={items[index]} />
    </div>
  )}
</FixedSizeList>
\`\`\`

### Backend Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**1. Database Indexes (Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ğ‘Ğ”)**

\`\`\`sql
-- Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
CREATE INDEX idx_projects_user_id ON projects(user_id);

-- Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
CREATE INDEX idx_templates_user_id ON templates(user_id);

-- ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°Ğ¼
CREATE INDEX idx_templates_name_tsv ON templates USING gin(name_tsv);
CREATE INDEX idx_templates_content_tsv ON templates USING gin(content_tsv);
\`\`\`

**2. Redis Caching (ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Redis)**

\`\`\`typescript
// apps/api/src/services/modelsCache.service.ts
class ModelsCacheService {
  private readonly CACHE_TTL = 3600 // 1 Ñ‡Ğ°Ñ

  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ñ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
   */
  async getModels(provider: string, apiKey?: string): Promise<AIModel[]> {
    const cacheKey = \`models:\${provider}\`
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞµÑˆ
    const cached = await redis.get(cacheKey)
    if (cached) {
      return JSON.parse(cached)
    }

    // Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ Ñƒ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
    const providerInstance = this.getProviderInstance(provider)
    const models = await providerInstance.getModels(apiKey)

    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² ĞºĞµÑˆ
    await redis.setex(cacheKey, this.CACHE_TTL, JSON.stringify(models))

    return models
  }

  /**
   * Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞµÑˆ
   */
  async invalidateCache(provider: string): Promise<void> {
    await redis.del(\`models:\${provider}\`)
  }
}
\`\`\`

**3. Full-Text Search (Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº)**

Ğ”Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸: ~7-8 ÑĞµĞºÑƒĞ½Ğ´ Ğ½Ğ° Ñ‚Ñ‹ÑÑÑ‡Ğ°Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹  
ĞŸĞ¾ÑĞ»Ğµ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸: 1-11ms

\`\`\`typescript
// apps/api/src/services/template.service.ts
async searchTemplates(userId: string, query: string): Promise<Template[]> {
  // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ PostgreSQL Full-Text Search Ñ GIN Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ğ¼Ğ¸
  const results = await prisma.$queryRaw<Template[]>\`
    SELECT 
      id, user_id, name, content, created_at, updated_at,
      ts_rank(name_tsv || content_tsv, to_tsquery('english', \${query})) as rank
    FROM templates
    WHERE user_id = \${userId}
      AND (
        name_tsv @@ to_tsquery('english', \${query}) OR
        content_tsv @@ to_tsquery('english', \${query})
      )
    ORDER BY rank DESC, updated_at DESC
    LIMIT 100
  \`

  return results
}
\`\`\`

**ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Full-Text Search:**

1. ĞŸÑ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ tsvector ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹:
\`\`\`sql
ALTER TABLE templates 
ADD COLUMN name_tsv tsvector 
GENERATED ALWAYS AS (to_tsvector('english', name)) STORED;

ALTER TABLE templates 
ADD COLUMN content_tsv tsvector 
GENERATED ALWAYS AS (to_tsvector('english', content)) STORED;
\`\`\`

2. GIN Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ğ½Ğ° ÑÑ‚Ğ¸Ñ… ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğ°Ñ…:
\`\`\`sql
CREATE INDEX idx_templates_name_tsv ON templates USING gin(name_tsv);
CREATE INDEX idx_templates_content_tsv ON templates USING gin(content_tsv);
\`\`\`

3. ĞŸĞ¾Ğ¸ÑĞº Ñ‡ĞµÑ€ĞµĞ· Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ `@@` (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ) Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `ts_rank` (Ñ€Ğ°Ğ½Ğ¶Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ).

**4. Connection Pooling (Ğ¿ÑƒĞ» ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹)**

\`\`\`typescript
// apps/api/prisma/schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Ğ’ DATABASE_URL ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿ÑƒĞ»Ğ°:
// postgresql://user:password@localhost:5432/db?
//   connection_limit=20&
//   pool_timeout=10
\`\`\`

**5. Query Optimization (Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)**

\`\`\`typescript
// âŒ ĞŸĞ»Ğ¾Ñ…Ğ¾: N+1 problem
const projects = await prisma.project.findMany({ where: { userId } })
for (const project of projects) {
  const user = await prisma.user.findUnique({ where: { id: project.userId } })
  // ...
}

// âœ… Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ include
const projects = await prisma.project.findMany({
  where: { userId },
  include: {
    user: true, // ĞĞ´Ğ¸Ğ½ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ JOIN
  },
})
\`\`\`

---

## ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ

### Horizontal Scaling (Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

\`\`\`
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    Nginx    â”‚
                        â”‚Load Balancerâ”‚
                        â”‚  (SSL/TLS)  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                â”‚                â”‚
              â–¼                â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Backend  â”‚     â”‚ Backend  â”‚     â”‚ Backend  â”‚
        â”‚Instance 1â”‚     â”‚Instance 2â”‚     â”‚Instance 3â”‚
        â”‚ (Fastify)â”‚     â”‚ (Fastify)â”‚     â”‚ (Fastify)â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚                â”‚                â”‚
             â”‚                â”‚                â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                           â”‚
                â–¼                           â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ PostgreSQL  â”‚            â”‚    Redis    â”‚
         â”‚  (Primary)  â”‚            â”‚   Cluster   â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚
         â–¼             â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚PostgreSQL â”‚ â”‚PostgreSQL â”‚
  â”‚(Replica 1)â”‚ â”‚(Replica 2)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        (Read queries)
\`\`\`

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Nginx Load Balancer:**

\`\`\`nginx
upstream backend {
    least_conn; # Ğ‘Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ½Ğ°Ğ¸Ğ¼ĞµĞ½ÑŒÑˆĞµĞ¼Ñƒ Ñ‡Ğ¸ÑĞ»Ñƒ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
    
    server backend1.promptyflow.com:3000 weight=1;
    server backend2.promptyflow.com:3000 weight=1;
    server backend3.promptyflow.com:3000 weight=1;
}

server {
    listen 443 ssl http2;
    server_name api.promptyflow.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host \$host;
        proxy_cache_bypass \$http_upgrade;
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
\`\`\`

### Database Scaling (Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ‘Ğ”)

**1. Read Replicas (Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ)**

\`\`\`typescript
// Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ/Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ
const prismaWrite = new PrismaClient({ datasources: { db: { url: PRIMARY_URL } } })
const prismaRead = new PrismaClient({ datasources: { db: { url: REPLICA_URL } } })

// Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ¸
const projects = await prismaRead.project.findMany({ where: { userId } })

// Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² primary
const newProject = await prismaWrite.project.create({ data: { ... } })
\`\`\`

**2. Sharding (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)**

Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼:

\`\`\`typescript
function getShardForUser(userId: string): 'shard1' | 'shard2' | 'shard3' {
  // Consistent hashing
  const hash = crypto.createHash('md5').update(userId).digest('hex')
  const numShards = 3
  const shardIndex = parseInt(hash.substring(0, 8), 16) % numShards
  return \`shard\${shardIndex + 1}\` as any
}

const shard = getShardForUser(userId)
const prisma = prismaClients[shard]
\`\`\`

**3. Connection Pooling Ñ PgBouncer**

\`\`\`
Application (20 connections) â”€â”€â”
Application (20 connections) â”€â”€â”¼â”€â†’ PgBouncer â”€â†’ PostgreSQL (100 connections)
Application (20 connections) â”€â”€â”˜     (pool)
\`\`\`

### Caching Strategy (ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)

**ĞœĞ½Ğ¾Ğ³Ğ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ¾Ğµ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CACHE LAYERS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  L1: Browser Cache (React Query)                             â”‚
â”‚      â€¢ Automatic caching                                     â”‚
â”‚      â€¢ staleTime: 5-15 min                                   â”‚
â”‚      â€¢ cacheTime: 10 min                                     â”‚
â”‚      Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ: projects, templates, AI models                  â”‚
â”‚                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚                                                               â”‚
â”‚  L2: Redis Cache (Backend)                                   â”‚
â”‚      â€¢ AI models list: 1 hour                                â”‚
â”‚      â€¢ User sessions: 7 days                                 â”‚
â”‚      â€¢ API rate limits: 1 min                                â”‚
â”‚      Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ: Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ AI, ÑĞµÑÑĞ¸Ğ¸, rate limiting               â”‚
â”‚                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚                                                               â”‚
â”‚  L3: PostgreSQL (Persistent Storage)                         â”‚
â”‚      â€¢ Permanent storage                                     â”‚
â”‚      â€¢ Full-text search indexes                              â”‚
â”‚      â€¢ Foreign key constraints                               â”‚
â”‚      Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ: users, projects, templates, api_keys            â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

---

## Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ñ…ĞµĞ¼Ğ° PostgreSQL

\`\`\`prisma
// apps/api/prisma/schema.prisma

model User {
  id            String    @id @default(cuid())
  googleId      String    @unique
  email         String    @unique
  name          String?
  picture       String?
  lastLoginAt   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  projects      Project[]
  templates     Template[]
  apiKeys       ApiKey[]

  @@index([googleId])
  @@index([email])
}

model Project {
  id        String   @id @default(cuid())
  userId    String
  name      String
  data      Json     // ProjectData { contextBlocks, promptBlocks }
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([updatedAt])
}

model Template {
  id         String   @id @default(cuid())
  userId     String
  name       String
  content    String   @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Generated columns Ğ´Ğ»Ñ full-text search
  name_tsv    Unsupported("tsvector")? @default(dbgenerated("to_tsvector('english', name)"))
  content_tsv Unsupported("tsvector")? @default(dbgenerated("to_tsvector('english', content)"))

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([name_tsv], type: Gin)
  @@index([content_tsv], type: Gin)
}

model ApiKey {
  id           String   @id @default(cuid())
  userId       String
  provider     String   // 'openai' | 'anthropic' | 'gemini' | 'grok' | 'openrouter'
  encryptedKey String   @db.Text
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider])
  @@index([userId])
}
\`\`\`

### Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

**ProjectData (Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² JSONB):**

\`\`\`typescript
interface ProjectData {
  contextBlocks: ContextBlock[]
  promptBlocks: PromptBlock[]
}

interface ContextBlock {
  id: number
  title: string
  items: ContextItem[]
}

interface ContextItem {
  id: number
  title: string
  content: string
  chars: number
  subItems?: SubItem[]
}

interface SubItem {
  id: number
  title: string
  content: string
  chars: number
}

interface PromptBlock {
  id: number
  title: string
  template: string
  wrapInTags: boolean
  selectedContext: SelectedContext[]
}

interface SelectedContext {
  blockId: number
  itemId: number
  subItemId?: number
  order: number
}
\`\`\`

### ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ full-text search:

\`\`\`sql
-- apps/api/prisma/migrations/20251203183130_add_fulltext_search_indexes/migration.sql

-- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ tsvector ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹
ALTER TABLE templates 
ADD COLUMN name_tsv tsvector 
GENERATED ALWAYS AS (to_tsvector('english', name)) STORED;

ALTER TABLE templates 
ADD COLUMN content_tsv tsvector 
GENERATED ALWAYS AS (to_tsvector('english', content)) STORED;

-- Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ GIN Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_templates_name_tsv ON templates USING gin(name_tsv);
CREATE INDEX idx_templates_content_tsv ON templates USING gin(content_tsv);
\`\`\`

---

## AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ²

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT REQUEST                            â”‚
â”‚  POST /ai/send                                              â”‚
â”‚  { provider: 'openai', model: 'gpt-4o', messages: [...] }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI ROUTE HANDLER                          â”‚
â”‚  1. Authenticate user                                        â”‚
â”‚  2. Get API key from database (encrypted)                    â”‚
â”‚  3. Decrypt API key                                          â”‚
â”‚  4. Select provider instance                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PROVIDER FACTORY                            â”‚
â”‚  switch (provider) {                                         â”‚
â”‚    case 'openai': return new OpenAIProvider()               â”‚
â”‚    case 'anthropic': return new AnthropicProvider()         â”‚
â”‚    case 'gemini': return new GeminiProvider()               â”‚
â”‚    case 'grok': return new GrokProvider()                   â”‚
â”‚    case 'openrouter': return new OpenRouterProvider()       â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 PROVIDER INSTANCE                            â”‚
â”‚  provider.sendMessage({                                      â”‚
â”‚    apiKey, model, messages, temperature, maxTokens          â”‚
â”‚  })                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI    â”‚  â”‚ Anthropic  â”‚  â”‚   Gemini   â”‚
â”‚    API     â”‚  â”‚    API     â”‚  â”‚    API     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI RESPONSE                                â”‚
â”‚  { content: 'Generated text...', usage: { ... } }           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RETURN TO CLIENT                           â”‚
â”‚  { success: true, response: 'Generated text...' }           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹

| ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ | ĞœĞ¾Ğ´ĞµĞ»Ğ¸ | ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ |
|-----------|--------|-------------|
| **OpenAI** | GPT-4o, GPT-4o-mini, GPT-4-turbo, GPT-3.5-turbo, GPT-5.1 | GPT-5.1 Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `/v1/responses` endpoint |
| **Anthropic** | Claude 4.5 Sonnet/Opus, Claude 4 Sonnet/Opus, Claude 3.5 Sonnet/Haiku | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ²ÑĞµÑ… Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Claude |
| **Google Gemini** | Gemini 2.5 Flash, Gemini 1.5 Flash/Pro | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ v1beta API |
| **X.AI Grok** | Grok Beta, Grok Vision Beta | ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ Ğ¾Ñ‚ X.AI |
| **OpenRouter** | 100+ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¾Ñ‚ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ² | ĞĞ³Ñ€ĞµĞ³Ğ°Ñ‚Ğ¾Ñ€ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ |

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

\`\`\`typescript
// Frontend: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ° Ğ² AI
const response = await api.post('/ai/send', {
  provider: 'openai',
  model: 'gpt-4o-mini',
  messages: [
    { role: 'system', content: 'You are a helpful assistant.' },
    { role: 'user', content: compiledPrompt }
  ],
  temperature: 0.7,
  maxTokens: 2000,
})

console.log(response.data.response)
\`\`\`

---

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Winston Logger

\`\`\`typescript
// apps/api/src/lib/logger.ts
import winston from 'winston'

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),
    new winston.transports.File({ 
      filename: 'logs/error.log', 
      level: 'error' 
    }),
    new winston.transports.File({ 
      filename: 'logs/combined.log' 
    })
  ]
})
\`\`\`

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ

**1. Performance Metrics (Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ):**
- API response time (p50, p95, p99)
- Database query time
- Redis cache hit ratio
- AI provider response time

**2. Business Metrics (Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸):**
- Daily Active Users (DAU)
- Monthly Active Users (MAU)
- Projects created per day
- AI API calls per day
- Template usage
- Average project size

**3. Error Metrics (Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸):**
- Error rate by endpoint
- Failed AI requests
- Database connection errors
- Authentication failures

---

**Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 05.12.2025  
**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 05.12.2025  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 2.0 (Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ñ€ÑƒÑÑĞºĞ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ)
